<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUNRISE CITY SLAMDOWN - DRAFT & TOURNAMENT</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #1a1a1a; color: #fff; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 20px; padding: 20px; background: #2a2a2a; border: 2px solid #444; }
        h1 { font-size: 2em; margin-bottom: 10px; }
        .turn-info { background: #333; padding: 15px; margin-bottom: 20px; border: 2px solid #555; text-align: center; }
        .current-turn { font-size: 1.5em; color: #ffcc00; margin-bottom: 10px; }
        .draft-order { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
        .captain-turn { padding: 8px 15px; background: #444; border: 2px solid #666; }
        .captain-turn.active { background: #ffcc00; color: #000; font-weight: bold; }
        .captain-turn.done { opacity: 0.5; text-decoration: line-through; }
        .main-content { display: grid; grid-template-columns: 250px 1fr 350px; gap: 20px; }
        .sidebar { background: #2a2a2a; padding: 15px; border: 2px solid #444; height: fit-content; }
        .right-panel { background: #2a2a2a; padding: 15px; border: 2px solid #444; max-height: 80vh; overflow-y: auto; }
        .admin-panel { background: #1a1a1a; border: 2px solid #ffcc00; padding: 15px; margin-bottom: 20px; display: none; }
        .admin-panel h3 { color: #ffcc00; margin-bottom: 10px; }
        .admin-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .admin-controls input, .admin-controls select, .admin-controls button { padding: 8px; background: #333; color: #fff; border: 1px solid #555; font-size: 0.9em; }
        .admin-controls button { background: #ffcc00; color: #000; cursor: pointer; font-weight: bold; }
        .admin-controls button:hover { background: #ffdd33; }
        .team-card { background: #333; padding: 12px; margin-bottom: 12px; border: 2px solid #555; border-left: 4px solid #ffcc00; }
        .team-card h4 { color: #ffcc00; margin-bottom: 8px; font-size: 1em; }
        .team-card-money { color: #00ff00; font-weight: bold; margin-bottom: 8px; font-size: 0.95em; }
        .team-players { font-size: 0.85em; line-height: 1.6; margin-bottom: 8px; }
        .player-entry { background: #444; padding: 4px 6px; margin-bottom: 4px; border-left: 2px solid #888; display: flex; justify-content: space-between; align-items: center; }
        .card-status { display: inline-block; padding: 2px 6px; background: #555; font-size: 0.8em; margin-top: 2px; cursor: pointer; }
        .card-status.active { background: #00aa00; color: #fff; }
        .card-status.used { background: #aa5500; color: #fff; }
        .card-status.unavailable { background: #aa0000; color: #fff; }
        .players-area { background: #2a2a2a; padding: 20px; border: 2px solid #444; }
        .category-section { margin-bottom: 30px; }
        .category-title { font-size: 1.3em; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #555; }
        .players-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; }
        .player-card { background: #333; padding: 12px; border: 2px solid #555; cursor: pointer; }
        .player-card:hover { background: #444; border-color: #ffcc00; }
        .player-card.sold { opacity: 0.3; cursor: not-allowed; text-decoration: line-through; }
        .player-name { font-weight: bold; margin-bottom: 5px; }
        .player-tier { display: inline-block; padding: 2px 8px; background: #555; font-size: 0.9em; margin-bottom: 5px; }
        .player-price { color: #00ff00; font-weight: bold; }
        .money { font-size: 1.8em; color: #00ff00; margin: 10px 0; }
        .teams-summary { margin-top: 20px; }
        .team-item { background: #333; padding: 10px; margin-bottom: 10px; border-left: 3px solid #666; }
        .team-item.active { border-left-color: #ffcc00; }

        /* Login Modal */
        .login-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center; }
        .login-modal.show { display: flex; }
        .login-box { background: #2a2a2a; padding: 30px; border: 2px solid #ffcc00; border-radius: 10px; width: 300px; }
        .login-box h3 { color: #ffcc00; margin-bottom: 20px; text-align: center; }
        .login-box input { width: 100%; padding: 10px; margin-bottom: 15px; background: #333; color: #fff; border: 1px solid #555; }
        .login-box button { width: 100%; padding: 10px; background: #ffcc00; color: #000; border: none; font-weight: bold; cursor: pointer; }
        .login-box .error { color: #ff0000; font-size: 0.9em; margin-bottom: 10px; display: none; }

        /* Admin Tabs */
        .admin-tabs { display: flex; gap: 5px; margin-bottom: 15px; flex-wrap: wrap; }
        .admin-tab { flex: 1; min-width: 80px; padding: 10px; background: #333; color: #fff; border: 2px solid #555; cursor: pointer; text-align: center; font-weight: bold; font-size: 0.85em; }
        .admin-tab:hover { background: #444; }
        .admin-tab.active { background: #ffcc00; color: #000; border-color: #ffcc00; }
        .admin-section { display: none; }
        .admin-section.active { display: block; }

        /* Player Management */
        .player-manager { background: #1a1a1a; border: 2px solid #00ff00; padding: 15px; margin-bottom: 15px; border-radius: 5px; }
        .player-manager h4 { color: #00ff00; margin-bottom: 10px; }
        .player-edit-list { max-height: 300px; overflow-y: auto; }
        .player-edit-item { display: flex; justify-content: space-between; align-items: center; padding: 8px; background: #333; margin-bottom: 5px; border-left: 3px solid #00ff00; }
        .player-edit-item input { width: 80px; padding: 4px; background: #444; color: #fff; border: 1px solid #555; }
        .player-edit-item button { padding: 4px 8px; margin-left: 5px; cursor: pointer; border: none; }
        .btn-save { background: #00aa00; color: #fff; }
        .btn-delete { background: #aa0000; color: #fff; }
        .btn-add { background: #00aa00; color: #fff; padding: 8px 15px; }

        /* Betting Panel for Players */
        .betting-view { background: #2a2a2a; padding: 20px; border: 2px solid #ff00ff; margin-bottom: 20px; }
        .betting-view h3 { color: #ff00ff; margin-bottom: 15px; }
        .bet-card { background: #333; padding: 12px; margin-bottom: 10px; border-left: 3px solid #ff00ff; }
        .bet-card.resolved { opacity: 0.7; border-left-color: #666; }
        .bet-teams { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .bet-team { flex: 1; text-align: center; padding: 8px; background: #444; }
        .bet-vs { padding: 0 15px; font-weight: bold; color: #ff00ff; }
        .bet-amount { text-align: center; color: #00ff00; font-weight: bold; margin-bottom: 10px; }
        .bet-controls { display: flex; gap: 5px; }
        .bet-controls button { flex: 1; padding: 8px; cursor: pointer; border: none; font-weight: bold; }
        .bet-win-1, .bet-win-2 { background: #00aa00; color: #fff; }
        .bet-cancel { background: #aa0000; color: #fff; }
        .new-bet-form { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .new-bet-form select, .new-bet-form input { padding: 8px; background: #333; color: #fff; border: 1px solid #555; }
        .new-bet-form button { grid-column: 1 / -1; padding: 10px; background: #ff00ff; color: #fff; border: none; cursor: pointer; font-weight: bold; }

        /* Match Tracker */
        .match-tracker { background: #1a1a1a; border: 2px solid #00ffff; padding: 15px; margin-bottom: 15px; border-radius: 5px; }
        .match-tracker h4 { color: #00ffff; margin-bottom: 10px; }
        .match-item { background: #333; padding: 10px; margin-bottom: 8px; border-left: 3px solid #00ffff; }
        .match-item.completed { border-left-color: #00ff00; }
        .match-item.team1-win { background: linear-gradient(90deg, rgba(0,170,0,0.3) 0%, #333 100%); }
        .match-item.team2-win { background: linear-gradient(270deg, rgba(0,170,0,0.3) 0%, #333 100%); }
        .match-teams { display: flex; justify-content: space-between; align-items: center; }
        .match-team-name { font-weight: bold; }
        .match-result { color: #00ff00; font-weight: bold; }

        /* Navigation */
        .nav-buttons { display: flex; gap: 10px; margin-bottom: 15px; }
        .nav-btn { flex: 1; padding: 12px; background: #333; color: #fff; border: 2px solid #555; cursor: pointer; font-weight: bold; text-align: center; }
        .nav-btn:hover { background: #444; border-color: #ffcc00; }
        .nav-btn.active { background: #ffcc00; color: #000; border-color: #ffcc00; }

        /* View containers */
        .view-container { display: none; }
        .view-container.active { display: block; }

        /* Captain Manager */
        .captain-manager { background: #1a1a1a; border: 2px solid #ff6600; padding: 15px; margin-bottom: 15px; border-radius: 5px; }
        .captain-manager h4 { color: #ff6600; margin-bottom: 10px; }
        .captain-list { max-height: 200px; overflow-y: auto; }
        .captain-list-item { display: flex; justify-content: space-between; align-items: center; padding: 8px; background: #333; margin-bottom: 5px; border-left: 3px solid #ff6600; }
        .captain-list-item.inactive { opacity: 0.5; border-left-color: #666; }
        .captain-list-item button { padding: 4px 8px; font-size: 0.8em; cursor: pointer; border: none; margin-left: 3px; }
        .btn-up, .btn-down { background: #555; color: #fff; }
        .btn-skip { background: #ffcc00; color: #000; }
        .btn-remove { background: #aa0000; color: #fff; }
        .btn-activate { background: #00aa00; color: #fff; }

        /* Roster Manager */
        .roster-manager { background: #1a1a1a; border: 2px solid #0099ff; padding: 15px; margin-bottom: 15px; border-radius: 5px; }
        .roster-manager h4 { color: #0099ff; margin-bottom: 10px; }
        .roster-teams-container { display: grid; grid-template-columns: 1fr 60px 1fr; gap: 10px; margin-bottom: 15px; }
        .roster-team-box { background: #333; padding: 10px; border: 2px solid #555; min-height: 150px; max-height: 250px; overflow-y: auto; }
        .roster-team-box h5 { color: #ffcc00; margin-bottom: 10px; text-align: center; }
        .roster-player-item { display: flex; justify-content: space-between; align-items: center; padding: 6px 8px; background: #444; margin-bottom: 4px; cursor: pointer; border: 1px solid transparent; }
        .roster-player-item:hover { background: #555; border-color: #ffcc00; }
        .roster-player-item.selected { background: #0066aa; border-color: #0099ff; }
        .roster-arrows { display: flex; flex-direction: column; justify-content: center; gap: 10px; }
        .roster-arrows button { padding: 10px; font-size: 1.2em; cursor: pointer; background: #555; color: #fff; border: none; }
        .roster-arrows button:hover { background: #0099ff; }

        /* Duel System */
        .duel-card { background: #1a3a1a; border: 2px solid #00ff00; padding: 12px; margin-bottom: 12px; border-radius: 5px; }
        .duel-vs { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; gap: 10px; }
        .duel-team { flex: 1; background: #333; padding: 8px; border: 1px solid #555; cursor: pointer; text-align: center; font-weight: bold; }
        .duel-team:hover { background: #444; border-color: #00ff00; }
        .duel-vs-text { font-weight: bold; color: #ffcc00; min-width: 40px; text-align: center; }
        .duel-controls { display: flex; gap: 5px; margin-top: 8px; }
        .duel-controls button { flex: 1; padding: 6px; font-size: 0.8em; cursor: pointer; border: 1px solid #555; }
        .winner-btn { background: #00aa00; color: #fff; }
        .loser-btn { background: #aa0000; color: #fff; }
        .sub-btn { background: #0099ff; color: #fff; }
        .duel-history { background: #333; padding: 8px; margin-top: 10px; border-left: 3px solid #00ff00; font-size: 0.85em; }

        /* Tournament */
        .tournament-section { background: #1a1a1a; border: 2px solid #00ff00; padding: 15px; margin-bottom: 20px; }
        .tournament-section h3 { color: #00ff00; margin-bottom: 10px; }
        .tournament-info { background: #1a1a1a; border: 2px solid #00ff00; padding: 12px; margin-bottom: 15px; border-radius: 5px; }
        .tournament-info h4 { color: #00ff00; margin-bottom: 8px; }
        .tournament-input { width: 100%; padding: 8px; background: #333; color: #fff; border: 1px solid #555; margin-bottom: 8px; }

        /* Final Teams */
        .final-teams { display: none; background: #2a2a2a; padding: 20px; border: 2px solid #444; }
        .final-teams.show { display: block; }
        .team-final { background: #333; padding: 15px; margin-bottom: 15px; border-left: 4px solid #ffcc00; }
        .team-final h3 { margin-bottom: 10px; color: #ffcc00; }
        .picked-player { padding: 5px 10px; background: #444; margin-bottom: 5px; border-left: 2px solid #666; }

        /* Status indicator */
        .status-bar { background: #333; padding: 8px 15px; margin-bottom: 10px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; }
        .status-saved { color: #00ff00; }
        .status-unsaved { color: #ffcc00; }

        /* Fixed buttons */
        #toggleAdminBtn { position: fixed; top: 20px; right: 20px; padding: 10px 15px; background: #ffcc00; color: #000; border: none; font-weight: bold; cursor: pointer; z-index: 1000; border-radius: 5px; }
        #toggleBettingBtn { position: fixed; top: 20px; right: 120px; padding: 10px 15px; background: #ff00ff; color: #fff; border: none; font-weight: bold; cursor: pointer; z-index: 1000; border-radius: 5px; }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="login-modal" id="loginModal">
        <div class="login-box">
            <h3>ADMIN LOGIN</h3>
            <div class="error" id="loginError">Invalid credentials</div>
            <input type="text" id="loginUser" placeholder="Username">
            <input type="password" id="loginPass" placeholder="Password">
            <button onclick="attemptLogin()">LOGIN</button>
            <button onclick="closeLogin()" style="margin-top: 10px; background: #666;">CANCEL</button>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>SUNRISE CITY SLAMDOWN - DRAFT</h1>
            <div class="status-bar">
                <span>Data Status: <span id="saveStatus" class="status-saved">Saved</span></span>
                <button onclick="saveAllData()" style="padding: 5px 10px; background: #00aa00; color: #fff; border: none; cursor: pointer;">Save Now</button>
            </div>
        </header>

        <!-- Navigation -->
        <div class="nav-buttons">
            <button class="nav-btn active" onclick="switchMainView('draft')">DRAFT</button>
            <button class="nav-btn" onclick="switchMainView('betting')">BETTING</button>
            <button class="nav-btn" onclick="switchMainView('matches')">MATCHES</button>
            <button class="nav-btn" onclick="switchMainView('tournament')">TOURNAMENT</button>
        </div>

        <div class="turn-info" id="turnInfo">
            <div class="current-turn" id="currentTurnDisplay">CURRENT TURN: JUAN</div>
            <div>Draft Order:</div>
            <div class="draft-order" id="draftOrder"></div>
        </div>

        <!-- Admin Panel -->
        <div class="admin-panel" id="adminPanel">
            <h3>ADMIN PANEL</h3>
            <div class="admin-tabs">
                <button class="admin-tab active" onclick="switchAdminTab('general')">General</button>
                <button class="admin-tab" onclick="switchAdminTab('players')">Players</button>
                <button class="admin-tab" onclick="switchAdminTab('captains')">Captains</button>
                <button class="admin-tab" onclick="switchAdminTab('roster')">Roster</button>
                <button class="admin-tab" onclick="switchAdminTab('bets')">Bets</button>
            </div>

            <!-- General Section -->
            <div id="adminGeneral" class="admin-section active">
                <div style="margin-bottom: 15px;">
                    <h4 style="color: #ffcc00; margin-bottom: 8px;">Add Money</h4>
                    <div class="admin-controls">
                        <select id="adminSelectCaptain"></select>
                        <input type="number" id="adminMoneyAmount" placeholder="Amount" min="1">
                        <button onclick="addMoneyAdmin()" style="grid-column: 1 / -1;">Add Money</button>
                    </div>
                </div>
                <div style="margin-bottom: 15px; border-top: 1px solid #555; padding-top: 10px;">
                    <h4 style="color: #ffcc00; margin-bottom: 8px;">Manage Players</h4>
                    <div class="admin-controls">
                        <select id="adminSelectSourceTeam" onchange="updatePlayerDropdown()"></select>
                        <select id="adminSelectPlayer"></select>
                        <select id="adminSelectTargetTeam"></select>
                        <button onclick="movePlayerAdmin()" style="grid-column: 1 / -1;">Move Player</button>
                        <button onclick="deletePlayerAdmin()" style="grid-column: 1 / -1; background: #aa0000;">Delete Player</button>
                    </div>
                </div>
                <div style="margin-bottom: 15px; border-top: 1px solid #555; padding-top: 10px;">
                    <button onclick="manualTournamentSetup()" style="width: 100%; padding: 8px; background: #00aa00; color: #fff; cursor: pointer; font-weight: bold; border: none;">Setup Custom Tournament</button>
                </div>
            </div>

            <!-- Players Management Section -->
            <div id="adminPlayers" class="admin-section">
                <div class="player-manager">
                    <h4>Manage All Players</h4>
                    <p style="font-size: 0.85em; color: #aaa; margin-bottom: 10px;">Add, remove, or change player prices</p>

                    <div style="margin-bottom: 15px;">
                        <h5 style="color: #ffcc00; margin-bottom: 8px;">Add New Player</h5>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 5px;">
                            <input type="text" id="newPlayerName" placeholder="Name">
                            <select id="newPlayerCategory">
                                <option value="kinoe">Hinoe</option>
                                <option value="tsuguko">Tsuguko</option>
                            </select>
                            <input type="number" id="newPlayerPrice" placeholder="Price" min="1">
                            <button class="btn-add" onclick="addNewPlayer()">Add</button>
                        </div>
                        <div style="margin-top: 5px;">
                            <input type="text" id="newPlayerTier" placeholder="Tier (for Tsuguko, e.g. S+, A, B)" style="width: 100%; padding: 5px; background: #333; color: #fff; border: 1px solid #555;">
                        </div>
                    </div>

                    <h5 style="color: #ffcc00; margin-bottom: 8px;">Wildcards (Available: <span id="wildcardCount">9</span>)</h5>
                    <div class="player-edit-list" id="wildcardEditList"></div>

                    <h5 style="color: #ffcc00; margin: 15px 0 8px 0;">Tsugukos</h5>
                    <div class="player-edit-list" id="tsugukosEditList"></div>

                    <h5 style="color: #ffcc00; margin: 15px 0 8px 0;">Hinoes</h5>
                    <div class="player-edit-list" id="kinoeEditList"></div>
                </div>
            </div>

            <!-- Captains Management Section -->
            <div id="adminCaptains" class="admin-section">
                <div class="captain-manager">
                    <h4>Captain Management</h4>
                    <p style="font-size: 0.85em; color: #aaa; margin-bottom: 10px;">Reorder, activate/deactivate or skip captains</p>
                    <div style="margin-bottom: 10px;">
                        <input type="text" id="newCaptainName" placeholder="New captain name" style="padding: 8px; background: #333; color: #fff; border: 1px solid #555; width: calc(100% - 90px);">
                        <button onclick="addNewCaptain()" style="padding: 8px 15px; background: #00aa00; color: #fff; border: none; cursor: pointer;">Add</button>
                    </div>
                    <div class="captain-list" id="captainList"></div>
                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #555;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="autoSkipNoMoney" onchange="toggleAutoSkip()">
                            <span style="font-size: 0.9em;">Auto-skip captains with no money</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Roster Management Section -->
            <div id="adminRoster" class="admin-section">
                <div class="roster-manager">
                    <h4>Roster Management</h4>
                    <p style="font-size: 0.85em; color: #aaa; margin-bottom: 10px;">Move players between teams easily</p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                        <select id="rosterSourceTeam" onchange="renderRosterSource()"></select>
                        <select id="rosterTargetTeam" onchange="renderRosterTarget()"></select>
                    </div>
                    <div class="roster-teams-container">
                        <div class="roster-team-box">
                            <h5 id="rosterSourceTitle">Source</h5>
                            <div id="rosterSourcePlayers"></div>
                        </div>
                        <div class="roster-arrows">
                            <button onclick="moveSelectedToTarget()" title="Move to target">→</button>
                            <button onclick="moveSelectedToSource()" title="Move to source">←</button>
                            <button onclick="moveAllToTarget()" title="Move all to target">⇒</button>
                        </div>
                        <div class="roster-team-box">
                            <h5 id="rosterTargetTitle">Target</h5>
                            <div id="rosterTargetPlayers"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Betting Section -->
            <div id="adminBets" class="admin-section">
                <div style="background: #1a1a1a; border: 2px solid #ff00ff; padding: 15px; border-radius: 5px;">
                    <h4 style="color: #ff00ff; margin-bottom: 10px;">Betting System (Admin)</h4>
                    <p style="font-size: 0.85em; color: #aaa; margin-bottom: 10px;">Create and resolve bets between teams/players</p>
                    <div class="new-bet-form">
                        <select id="betTeam1"></select>
                        <select id="betTeam2"></select>
                        <input type="number" id="betAmount" placeholder="Bet amount (YEN)" min="1" style="grid-column: 1 / -1;">
                        <input type="text" id="betDescription" placeholder="Description (optional)" style="grid-column: 1 / -1;">
                        <button onclick="createBet()">Create Bet</button>
                    </div>
                    <div id="adminActiveBets">
                        <h5 style="color: #ff00ff; margin: 15px 0 10px 0;">Active Bets:</h5>
                        <div id="adminBetsList"></div>
                    </div>
                </div>
            </div>

            <div style="border-top: 1px solid #555; padding-top: 10px; margin-top: 10px;">
                <button onclick="toggleAdminPanel()" style="width: 100%; padding: 8px; background: #666; color: #fff; cursor: pointer; border: none;">Close</button>
            </div>
            <div id="adminLog" style="font-size: 0.8em; color: #999; margin-top: 10px; max-height: 100px; overflow-y: auto;"></div>
        </div>

        <button id="toggleAdminBtn" onclick="showLoginModal()">ADMIN</button>
        <button id="toggleBettingBtn" onclick="switchMainView('betting')">BETS</button>

        <!-- DRAFT VIEW -->
        <div class="view-container active" id="draftView">
            <div class="main-content">
                <div class="sidebar">
                    <h3>CURRENT CAPTAIN</h3>
                    <div id="currentCaptainName" style="font-size: 1.3em; margin: 10px 0;">JUAN</div>
                    <div class="money" id="moneyDisplay">1000 YEN</div>
                    <div style="margin-top: 20px;">
                        <strong>WAYS TO EARN MONEY:</strong>
                        <div style="margin-top: 10px; font-size: 0.9em;">
                            <div>WIN: +300 YEN</div>
                            <div>ACE: +500 YEN</div>
                        </div>
                    </div>
                    <div class="teams-summary" id="teamsSummary"></div>
                </div>

                <div class="players-area" id="playersArea">
                    <div class="category-section">
                        <div class="category-title">WILD CARDS</div>
                        <div class="players-list" id="wildcards"></div>
                    </div>
                    <div class="category-section">
                        <div class="category-title">TSUGUKOS (Max 2 per team)</div>
                        <div class="players-list" id="tsugukos"></div>
                    </div>
                    <div class="category-section">
                        <div class="category-title">HINOES</div>
                        <div class="players-list" id="kinoe"></div>
                    </div>
                </div>

                <div class="right-panel">
                    <div id="teamsPanel"></div>
                </div>
            </div>
        </div>

        <!-- BETTING VIEW (for players) -->
        <div class="view-container" id="bettingView">
            <div class="betting-view">
                <h3>ACTIVE BETS</h3>
                <p style="font-size: 0.9em; color: #aaa; margin-bottom: 15px;">View current bets and their status</p>
                <div id="publicBetsList"></div>

                <h3 style="margin-top: 20px;">BET HISTORY</h3>
                <div id="publicBetsHistory"></div>
            </div>

            <div class="right-panel" style="max-height: none;">
                <h3 style="color: #ffcc00; margin-bottom: 15px;">TEAM STANDINGS</h3>
                <div id="bettingTeamsPanel"></div>
            </div>
        </div>

        <!-- MATCHES VIEW -->
        <div class="view-container" id="matchesView">
            <div class="match-tracker">
                <h4>MATCH HISTORY</h4>
                <p style="font-size: 0.85em; color: #aaa; margin-bottom: 10px;">Track all matches and results</p>
                <div id="matchHistory"></div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <h3 style="color: #00ffff; margin-bottom: 15px;">TEAM STATS</h3>
                    <div id="teamStatsPanel"></div>
                </div>
                <div>
                    <h3 style="color: #ffcc00; margin-bottom: 15px;">ALL TEAMS</h3>
                    <div id="matchesTeamsPanel"></div>
                </div>
            </div>
        </div>

        <!-- TOURNAMENT VIEW -->
        <div class="view-container" id="tournamentView">
            <div id="tournamentContainer"></div>
        </div>

        <div class="final-teams" id="finalTeams">
            <h2 style="margin-bottom: 20px;">FINAL TEAMS</h2>
            <div id="finalTeamsList"></div>
        </div>
    </div>

    <script>
        // ==========================================
        // GAME DATA
        // ==========================================
        let wildcards = [
            { name: 'WILD CARD (MYTHICAL)', price: 1000, count: 3 },
            { name: 'WILD CARD (LEGENDARY)', price: 500, count: 3 },
            { name: 'WILD CARD (RARE)', price: 250, count: 3 }
        ];

        let tsugukos = [
            { name: 'UBUME', tier: 'B', price: 400 },
            { name: 'AIDAN', tier: 'B', price: 300 },
            { name: 'BEN', tier: 'A-', price: 300 },
            { name: 'GIAN', tier: 'A-', price: 300 },
            { name: 'HEISEI', tier: 'A+', price: 375 },
            { name: 'JACOB', tier: 'A-', price: 300 },
            { name: 'KAZUO', tier: 'C+', price: 400 },
            { name: 'MAT', tier: 'S', price: 425 },
            { name: 'MIKAMI', tier: 'S+', price: 400 },
            { name: 'MIKU', tier: 'A', price: 450 },
            { name: 'MIZUIRO', tier: 'B-', price: 300 },
            { name: 'POG', tier: 'B', price: 300 },
            { name: 'REL', tier: 'S', price: 425 },
            { name: 'LUNAR', tier: 'S+', price: 400 },
            { name: 'LIGHT', tier: 'C', price: 300 },
            { name: 'SEV', tier: 'B', price: 350 },
            { name: 'SOUL', tier: 'A-', price: 300 },
            { name: 'STEFAN', tier: 'F+', price: 300 },
            { name: 'CLOUD', tier: 'S', price: 375 },
            { name: 'TSUYA', tier: 'C-', price: 350 },
            { name: 'YAMI', tier: 'D+', price: 300, special: 'BUY 1 GET A HINOE FOR FREE' },
            { name: 'ZAYA', tier: 'B+', price: 300 },
            { name: 'CRUZ', tier: 'B', price: 300 },
            { name: 'BEEFY', tier: 'S+', price: 1000 }
        ];

        let kinoe = [
            { name: 'MOZART', price: 150 },
            { name: 'ALON MOR', price: 150 },
            { name: 'SPONGEBOB', price: 150 },
            { name: 'BLANCHE', price: 150 },
            { name: 'AYAKA', price: 150 },
            { name: 'BACONLAD', price: 150 },
            { name: 'DARK', price: 150 },
            { name: 'COMMTON', price: 150 },
            { name: 'ETHAN', price: 150 },
            { name: 'GIN', price: 150 },
            { name: 'REMOVE', price: 150 },
            { name: 'HINO', price: 150 },
            { name: 'HOLY', price: 150 },
            { name: 'ISAKI', price: 150 },
            { name: 'JOHN PICKLER', price: 150 },
            { name: 'AKARI', price: 150 },
            { name: 'KUTA', price: 150 },
            { name: 'LOGAN', price: 150 },
            { name: 'MAKOTO', price: 150 },
            { name: 'MAZE', price: 150 },
            { name: 'JAYCAR', price: 150 },
            { name: 'PANDA', price: 150 },
            { name: 'AKIO', price: 150 },
            { name: 'MERO', price: 700 },
            { name: 'ZARETH', price: 250 },
            { name: 'SAIN', price: 200 },
            { name: 'GROOVY', price: 300 }
        ];

        // ==========================================
        // GAME STATE
        // ==========================================
        let draftOrder = ['JUAN', 'RIOT', 'TACK', 'GLORY', 'SIMON', 'JUSTIN'];
        let captainStatus = {};
        let autoSkipNoMoney = false;
        let currentTurnIndex = 0;
        let roundNumber = 1;
        let captainMoney = {};
        let captainTeams = {};
        let soldPlayers = {};
        let wildcardsAvailable = {};
        let adminLog = [];
        let tournamentMatches = [];
        let cardStatus = {};
        let currentView = 'draft';
        let mainView = 'draft';
        let tournamentName = 'Tournament';
        let duels = [];
        let duelHistory = [];
        let currentDuelIndex = 0;
        let bets = [];
        let betsHistory = [];
        let betIdCounter = 1;
        let selectedSourcePlayers = [];
        let selectedTargetPlayers = [];
        let isAdminLoggedIn = false;
        let matchHistory = [];

        // Admin credentials
        const ADMIN_USER = 'Tack';
        const ADMIN_PASS = 'Tack123';

        // ==========================================
        // INITIALIZATION
        // ==========================================
        function initializeGame() {
            // Try to load saved data first
            if (loadAllData()) {
                console.log('Data loaded from localStorage');
            } else {
                // Initialize fresh state
                draftOrder.forEach(captain => {
                    captainMoney[captain] = 1000;
                    captainTeams[captain] = [];
                    captainStatus[captain] = 'active';
                });
                wildcards.forEach((card, i) => {
                    wildcardsAvailable[i] = card.count;
                });
            }

            updateTurnDisplay();
            renderPlayers();
            renderTeamsSummary();
            renderRightPanel();
            updateWildcardCount();
        }

        // ==========================================
        // LOCAL STORAGE FUNCTIONS
        // ==========================================
        function saveAllData() {
            const data = {
                wildcards, tsugukos, kinoe, draftOrder, captainStatus,
                autoSkipNoMoney, currentTurnIndex, roundNumber,
                captainMoney, captainTeams, soldPlayers, wildcardsAvailable,
                adminLog, tournamentMatches, cardStatus, currentView, mainView,
                tournamentName, duels, duelHistory, currentDuelIndex,
                bets, betsHistory, betIdCounter, matchHistory
            };

            try {
                localStorage.setItem('sunriseCitySlamdown', JSON.stringify(data));
                document.getElementById('saveStatus').textContent = 'Saved';
                document.getElementById('saveStatus').className = 'status-saved';
                console.log('Data saved successfully');
                return true;
            } catch (e) {
                console.error('Error saving data:', e);
                document.getElementById('saveStatus').textContent = 'Error!';
                document.getElementById('saveStatus').className = 'status-unsaved';
                return false;
            }
        }

        function loadAllData() {
            try {
                const saved = localStorage.getItem('sunriseCitySlamdown');
                if (!saved) return false;

                const data = JSON.parse(saved);

                // Restore all data
                if (data.wildcards) wildcards = data.wildcards;
                if (data.tsugukos) tsugukos = data.tsugukos;
                if (data.kinoe) kinoe = data.kinoe;
                if (data.draftOrder) draftOrder = data.draftOrder;
                if (data.captainStatus) captainStatus = data.captainStatus;
                if (data.autoSkipNoMoney !== undefined) autoSkipNoMoney = data.autoSkipNoMoney;
                if (data.currentTurnIndex !== undefined) currentTurnIndex = data.currentTurnIndex;
                if (data.roundNumber !== undefined) roundNumber = data.roundNumber;
                if (data.captainMoney) captainMoney = data.captainMoney;
                if (data.captainTeams) captainTeams = data.captainTeams;
                if (data.soldPlayers) soldPlayers = data.soldPlayers;
                if (data.wildcardsAvailable) wildcardsAvailable = data.wildcardsAvailable;
                if (data.adminLog) adminLog = data.adminLog;
                if (data.tournamentMatches) tournamentMatches = data.tournamentMatches;
                if (data.cardStatus) cardStatus = data.cardStatus;
                if (data.currentView) currentView = data.currentView;
                if (data.mainView) mainView = data.mainView;
                if (data.tournamentName) tournamentName = data.tournamentName;
                if (data.duels) duels = data.duels;
                if (data.duelHistory) duelHistory = data.duelHistory;
                if (data.currentDuelIndex !== undefined) currentDuelIndex = data.currentDuelIndex;
                if (data.bets) bets = data.bets;
                if (data.betsHistory) betsHistory = data.betsHistory;
                if (data.betIdCounter !== undefined) betIdCounter = data.betIdCounter;
                if (data.matchHistory) matchHistory = data.matchHistory;

                return true;
            } catch (e) {
                console.error('Error loading data:', e);
                return false;
            }
        }

        function markUnsaved() {
            document.getElementById('saveStatus').textContent = 'Unsaved';
            document.getElementById('saveStatus').className = 'status-unsaved';
        }

        // Auto-save every 30 seconds
        setInterval(saveAllData, 30000);

        // ==========================================
        // LOGIN FUNCTIONS
        // ==========================================
        function showLoginModal() {
            if (isAdminLoggedIn) {
                toggleAdminPanel();
            } else {
                document.getElementById('loginModal').classList.add('show');
                document.getElementById('loginUser').focus();
            }
        }

        function closeLogin() {
            document.getElementById('loginModal').classList.remove('show');
            document.getElementById('loginUser').value = '';
            document.getElementById('loginPass').value = '';
            document.getElementById('loginError').style.display = 'none';
        }

        function attemptLogin() {
            const user = document.getElementById('loginUser').value;
            const pass = document.getElementById('loginPass').value;

            if (user === ADMIN_USER && pass === ADMIN_PASS) {
                isAdminLoggedIn = true;
                closeLogin();
                toggleAdminPanel();
                document.getElementById('toggleAdminBtn').textContent = 'ADMIN (ON)';
                document.getElementById('toggleAdminBtn').style.background = '#00ff00';
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        }

        // ==========================================
        // VIEW SWITCHING
        // ==========================================
        function switchMainView(view) {
            mainView = view;

            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Hide all views
            document.querySelectorAll('.view-container').forEach(v => v.classList.remove('active'));

            // Show selected view
            document.getElementById(view + 'View').classList.add('active');

            // Update content based on view
            if (view === 'betting') {
                renderPublicBets();
                renderBettingTeams();
            } else if (view === 'matches') {
                renderMatchHistory();
                renderTeamStats();
                renderMatchesTeams();
            } else if (view === 'tournament') {
                renderTournamentView();
            }

            markUnsaved();
        }

        // ==========================================
        // DRAFT FUNCTIONS
        // ==========================================
        function getCurrentCaptain() {
            return draftOrder[currentTurnIndex];
        }

        function nextTurn() {
            currentTurnIndex++;
            if (currentTurnIndex >= draftOrder.length) {
                currentTurnIndex = 0;
                roundNumber++;
            }
            updateTurnDisplay();
            renderTeamsSummary();
            renderRightPanel();
            markUnsaved();
        }

        function updateTurnDisplay() {
            const current = getCurrentCaptain();
            document.getElementById('currentTurnDisplay').textContent = `CURRENT TURN: ${current}`;
            document.getElementById('currentCaptainName').textContent = current;
            document.getElementById('moneyDisplay').textContent = `${captainMoney[current] || 0} YEN`;

            const orderContainer = document.getElementById('draftOrder');
            orderContainer.innerHTML = '';
            draftOrder.forEach((captain, i) => {
                const div = document.createElement('div');
                div.className = 'captain-turn';
                if (i === currentTurnIndex) div.classList.add('active');
                if (i < currentTurnIndex) div.classList.add('done');
                div.textContent = `${i + 1}. ${captain}`;
                orderContainer.appendChild(div);
            });
        }

        function renderPlayers() {
            // Wildcards
            const wildcardsContainer = document.getElementById('wildcards');
            wildcardsContainer.innerHTML = '';
            wildcards.forEach((card, index) => {
                const available = wildcardsAvailable[index] || 0;
                if (available > 0) {
                    const cardEl = document.createElement('div');
                    cardEl.className = 'player-card';
                    cardEl.innerHTML = `
                        <div class="player-name">${card.name}</div>
                        <div class="player-price">${card.price} YEN</div>
                        <div style="font-size: 0.9em; margin-top: 5px;">Available: ${available}</div>
                    `;
                    cardEl.onclick = () => draftPlayer(card, `wildcard-${index}`, 'wildcard', index);
                    wildcardsContainer.appendChild(cardEl);
                }
            });

            // Tsugukos
            const tsugukosContainer = document.getElementById('tsugukos');
            tsugukosContainer.innerHTML = '';
            tsugukos.forEach((player, index) => {
                const isSold = soldPlayers[`tsuguko-${index}`];
                const cardEl = document.createElement('div');
                cardEl.className = `player-card ${isSold ? 'sold' : ''}`;
                cardEl.innerHTML = `
                    <div class="player-name">${player.name}</div>
                    <span class="player-tier">${player.tier}</span>
                    <div class="player-price">${player.price} YEN</div>
                    ${player.special ? `<div style="font-size: 0.8em; color: #ffcc00; margin-top: 5px;">${player.special}</div>` : ''}
                `;
                if (!isSold) {
                    cardEl.onclick = () => draftPlayer(player, `tsuguko-${index}`, 'tsuguko');
                }
                tsugukosContainer.appendChild(cardEl);
            });

            // Kinoe
            const kinoeContainer = document.getElementById('kinoe');
            kinoeContainer.innerHTML = '';
            kinoe.forEach((player, index) => {
                const isSold = soldPlayers[`kinoe-${index}`];
                const cardEl = document.createElement('div');
                cardEl.className = `player-card ${isSold ? 'sold' : ''}`;
                cardEl.innerHTML = `
                    <div class="player-name">${player.name}</div>
                    <div class="player-price">${player.price} YEN</div>
                `;
                if (!isSold) {
                    cardEl.onclick = () => draftPlayer(player, `kinoe-${index}`, 'kinoe');
                }
                kinoeContainer.appendChild(cardEl);
            });
        }

        function draftPlayer(player, playerId, category, wildcardIndex) {
            const current = getCurrentCaptain();
            const currentTeam = captainTeams[current];

            if (category === 'tsuguko') {
                const tsugukoCount = currentTeam.filter(p => p.category === 'tsuguko').length;
                if (tsugukoCount >= 2) {
                    alert('Maximum 2 Tsugukos per team!');
                    return;
                }
            }

            if (captainMoney[current] < player.price) {
                alert('Not enough money!');
                return;
            }

            captainMoney[current] -= player.price;

            if (category === 'wildcard') {
                wildcardsAvailable[wildcardIndex]--;
            } else {
                soldPlayers[playerId] = current;
            }

            const playerId_unique = `${current}-${playerId}-${Date.now()}`;
            currentTeam.push({
                ...player,
                category: category,
                id: playerId_unique,
                purchaseId: playerId
            });

            cardStatus[playerId_unique] = 'active';

            if (player.name === 'YAMI') {
                const availableKinoe = kinoe.filter((k, i) => !soldPlayers[`kinoe-${i}`]);
                if (availableKinoe.length > 0) {
                    const bonusPlayer = availableKinoe[0];
                    const bonusIndex = kinoe.indexOf(bonusPlayer);
                    soldPlayers[`kinoe-${bonusIndex}`] = current;
                    const bonusPlayerId = `${current}-kinoe-${bonusIndex}-bonus`;
                    currentTeam.push({
                        ...bonusPlayer,
                        category: 'kinoe',
                        bonus: true,
                        id: bonusPlayerId
                    });
                    cardStatus[bonusPlayerId] = 'active';
                    alert(`BONUS! ${bonusPlayer.name} added for FREE!`);
                }
            }

            if (captainMoney[current] <= 0) {
                alert(`${current} is out of money!`);
                checkDraftEnd();
            }

            nextTurn();
            renderPlayers();
            updateWildcardCount();
        }

        function checkDraftEnd() {
            const allOutOfMoney = draftOrder.every(cap => captainMoney[cap] <= 0);
            if (allOutOfMoney) {
                showFinalTeams();
            }
        }

        function showFinalTeams() {
            document.getElementById('playersArea').style.display = 'none';
            document.getElementById('turnInfo').style.display = 'none';
            const finalTeamsDiv = document.getElementById('finalTeams');
            finalTeamsDiv.classList.add('show');

            const listDiv = document.getElementById('finalTeamsList');
            listDiv.innerHTML = '';

            draftOrder.forEach(captain => {
                const teamDiv = document.createElement('div');
                teamDiv.className = 'team-final';

                let html = `<h3>${captain} - Remaining: ${captainMoney[captain]} YEN</h3>`;

                if (captainTeams[captain].length === 0) {
                    html += '<div>No players drafted</div>';
                } else {
                    captainTeams[captain].forEach(player => {
                        html += `<div class="picked-player">${player.name} ${player.tier ? `(${player.tier})` : ''} - ${player.bonus ? 'FREE' : player.price + ' YEN'}</div>`;
                    });
                }

                teamDiv.innerHTML = html;
                listDiv.appendChild(teamDiv);
            });

            const setupBtn = document.createElement('button');
            setupBtn.textContent = 'Setup Custom Tournament';
            setupBtn.style.cssText = 'width: 100%; padding: 12px; margin-top: 15px; background: #00ff00; color: #000; font-weight: bold; cursor: pointer; border: none; font-size: 1.1em;';
            setupBtn.onclick = manualTournamentSetup;
            listDiv.parentElement.appendChild(setupBtn);
        }

        function renderTeamsSummary() {
            const summaryDiv = document.getElementById('teamsSummary');
            summaryDiv.innerHTML = '<h3 style="margin-top: 20px; margin-bottom: 10px;">TEAMS</h3>';

            draftOrder.forEach(captain => {
                const isActive = captain === getCurrentCaptain();
                const teamDiv = document.createElement('div');
                teamDiv.className = `team-item ${isActive ? 'active' : ''}`;

                const playerCount = (captainTeams[captain] || []).length;
                teamDiv.innerHTML = `
                    <strong>${captain}</strong>
                    <div style="font-size: 0.9em; margin-top: 5px;">
                        Players: ${playerCount} | ${captainMoney[captain] || 0} YEN
                    </div>
                `;
                summaryDiv.appendChild(teamDiv);
            });
        }

        // ==========================================
        // ADMIN PANEL FUNCTIONS
        // ==========================================
        function toggleAdminPanel() {
            const adminPanel = document.getElementById('adminPanel');
            adminPanel.style.display = adminPanel.style.display === 'none' ? 'block' : 'none';

            if (adminPanel.style.display === 'block') {
                populateAdminSelectors();
                renderPlayerEditLists();
                renderCaptainList();
                populateRosterSelectors();
                populateBetSelectors();
                renderAdminBetsList();
            }
        }

        function populateAdminSelectors() {
            const selectCaptain = document.getElementById('adminSelectCaptain');
            selectCaptain.innerHTML = '<option value="">Select Captain</option>';
            draftOrder.forEach(captain => {
                selectCaptain.innerHTML += `<option value="${captain}">${captain}</option>`;
            });

            const sourceTeam = document.getElementById('adminSelectSourceTeam');
            const targetTeam = document.getElementById('adminSelectTargetTeam');

            sourceTeam.innerHTML = '<option value="">Select Team</option>';
            targetTeam.innerHTML = '<option value="">Target Team</option>';

            draftOrder.forEach(captain => {
                sourceTeam.innerHTML += `<option value="${captain}">${captain}</option>`;
                targetTeam.innerHTML += `<option value="${captain}">${captain}</option>`;
            });
        }

        function updatePlayerDropdown() {
            const sourceTeam = document.getElementById('adminSelectSourceTeam').value;
            const playerSelect = document.getElementById('adminSelectPlayer');

            playerSelect.innerHTML = '<option value="">Select Player</option>';

            if (!sourceTeam || !captainTeams[sourceTeam]) return;

            captainTeams[sourceTeam].forEach((player, index) => {
                playerSelect.innerHTML += `<option value="${index}">${player.name} (${player.tier || 'Regular'})</option>`;
            });
        }

        function addMoneyAdmin() {
            const captain = document.getElementById('adminSelectCaptain').value;
            const amount = parseInt(document.getElementById('adminMoneyAmount').value);

            if (!captain || !amount || amount <= 0) {
                alert('Select captain and enter valid amount!');
                return;
            }

            captainMoney[captain] = (captainMoney[captain] || 0) + amount;
            const logEntry = `${new Date().toLocaleTimeString()}: Added ${amount} YEN to ${captain}`;
            adminLog.push(logEntry);

            document.getElementById('adminMoneyAmount').value = '';
            document.getElementById('adminLog').textContent = adminLog.slice(-3).join('\n');

            updateTurnDisplay();
            renderRightPanel();
            markUnsaved();
            alert(`${amount} YEN added to ${captain}!`);
        }

        function movePlayerAdmin() {
            const sourceTeam = document.getElementById('adminSelectSourceTeam').value;
            const playerIndex = parseInt(document.getElementById('adminSelectPlayer').value);
            const targetTeam = document.getElementById('adminSelectTargetTeam').value;

            if (!sourceTeam || isNaN(playerIndex) || !targetTeam || sourceTeam === targetTeam) {
                alert('Please select all fields correctly!');
                return;
            }

            const player = captainTeams[sourceTeam][playerIndex];
            captainTeams[sourceTeam].splice(playerIndex, 1);

            player.id = `${targetTeam}-${player.purchaseId}-${Date.now()}`;
            captainTeams[targetTeam].push(player);

            adminLog.push(`${new Date().toLocaleTimeString()}: Moved ${player.name} from ${sourceTeam} to ${targetTeam}`);
            document.getElementById('adminLog').textContent = adminLog.slice(-3).join('\n');

            alert(`${player.name} moved to ${targetTeam}!`);
            renderPlayers();
            renderRightPanel();
            updatePlayerDropdown();
            markUnsaved();
        }

        function deletePlayerAdmin() {
            const sourceTeam = document.getElementById('adminSelectSourceTeam').value;
            const playerIndex = parseInt(document.getElementById('adminSelectPlayer').value);

            if (!sourceTeam || isNaN(playerIndex)) {
                alert('Please select team and player!');
                return;
            }

            const player = captainTeams[sourceTeam][playerIndex];
            if (!confirm(`Delete ${player.name} from ${sourceTeam}?`)) return;

            captainTeams[sourceTeam].splice(playerIndex, 1);
            adminLog.push(`${new Date().toLocaleTimeString()}: Deleted ${player.name} from ${sourceTeam}`);
            document.getElementById('adminLog').textContent = adminLog.slice(-3).join('\n');

            alert(`${player.name} deleted!`);
            renderPlayers();
            renderRightPanel();
            updatePlayerDropdown();
            markUnsaved();
        }

        function switchAdminTab(tabName) {
            document.querySelectorAll('.admin-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.admin-section').forEach(section => section.classList.remove('active'));

            const sectionId = 'admin' + tabName.charAt(0).toUpperCase() + tabName.slice(1);
            document.getElementById(sectionId).classList.add('active');

            if (tabName === 'players') renderPlayerEditLists();
            else if (tabName === 'captains') renderCaptainList();
            else if (tabName === 'roster') populateRosterSelectors();
            else if (tabName === 'bets') { populateBetSelectors(); renderAdminBetsList(); }
        }

        // ==========================================
        // PLAYER MANAGEMENT FUNCTIONS
        // ==========================================
        function renderPlayerEditLists() {
            // Wildcards
            const wildcardList = document.getElementById('wildcardEditList');
            wildcardList.innerHTML = '';
            wildcards.forEach((card, i) => {
                const available = wildcardsAvailable[i] || 0;
                wildcardList.innerHTML += `
                    <div class="player-edit-item">
                        <span>${card.name} (${available} left)</span>
                        <div>
                            <input type="number" value="${card.price}" id="wc-price-${i}" min="1">
                            <input type="number" value="${card.count}" id="wc-count-${i}" min="0" style="width: 50px;">
                            <button class="btn-save" onclick="updateWildcard(${i})">Save</button>
                        </div>
                    </div>
                `;
            });

            // Tsugukos
            const tsugukosEditList = document.getElementById('tsugukosEditList');
            tsugukosEditList.innerHTML = '';
            tsugukos.forEach((player, i) => {
                const sold = soldPlayers[`tsuguko-${i}`] ? ' (SOLD)' : '';
                tsugukosEditList.innerHTML += `
                    <div class="player-edit-item">
                        <span>${player.name} [${player.tier}]${sold}</span>
                        <div>
                            <input type="number" value="${player.price}" id="tsu-price-${i}" min="1">
                            <button class="btn-save" onclick="updateTsuguko(${i})">Save</button>
                            <button class="btn-delete" onclick="deleteTsuguko(${i})">X</button>
                        </div>
                    </div>
                `;
            });

            // Kinoe
            const kinoeEditList = document.getElementById('kinoeEditList');
            kinoeEditList.innerHTML = '';
            kinoe.forEach((player, i) => {
                const sold = soldPlayers[`kinoe-${i}`] ? ' (SOLD)' : '';
                kinoeEditList.innerHTML += `
                    <div class="player-edit-item">
                        <span>${player.name}${sold}</span>
                        <div>
                            <input type="number" value="${player.price}" id="kin-price-${i}" min="1">
                            <button class="btn-save" onclick="updateKinoe(${i})">Save</button>
                            <button class="btn-delete" onclick="deleteKinoe(${i})">X</button>
                        </div>
                    </div>
                `;
            });
        }

        function updateWildcard(index) {
            const price = parseInt(document.getElementById(`wc-price-${index}`).value);
            const count = parseInt(document.getElementById(`wc-count-${index}`).value);
            if (price > 0) wildcards[index].price = price;
            if (count >= 0) {
                wildcards[index].count = count;
                wildcardsAvailable[index] = count;
            }
            renderPlayers();
            updateWildcardCount();
            markUnsaved();
            alert('Wildcard updated!');
        }

        function updateTsuguko(index) {
            const price = parseInt(document.getElementById(`tsu-price-${index}`).value);
            if (price > 0) tsugukos[index].price = price;
            renderPlayers();
            markUnsaved();
            alert('Tsuguko updated!');
        }

        function updateKinoe(index) {
            const price = parseInt(document.getElementById(`kin-price-${index}`).value);
            if (price > 0) kinoe[index].price = price;
            renderPlayers();
            markUnsaved();
            alert('Hinoe updated!');
        }

        function deleteTsuguko(index) {
            if (!confirm(`Delete ${tsugukos[index].name}?`)) return;
            tsugukos.splice(index, 1);
            renderPlayers();
            renderPlayerEditLists();
            markUnsaved();
        }

        function deleteKinoe(index) {
            if (!confirm(`Delete ${kinoe[index].name}?`)) return;
            kinoe.splice(index, 1);
            renderPlayers();
            renderPlayerEditLists();
            markUnsaved();
        }

        function addNewPlayer() {
            const name = document.getElementById('newPlayerName').value.trim().toUpperCase();
            const category = document.getElementById('newPlayerCategory').value;
            const price = parseInt(document.getElementById('newPlayerPrice').value);
            const tier = document.getElementById('newPlayerTier').value.trim().toUpperCase();

            if (!name || !price || price <= 0) {
                alert('Enter valid name and price!');
                return;
            }

            if (category === 'tsuguko') {
                tsugukos.push({ name, tier: tier || 'C', price });
            } else {
                kinoe.push({ name, price });
            }

            document.getElementById('newPlayerName').value = '';
            document.getElementById('newPlayerPrice').value = '';
            document.getElementById('newPlayerTier').value = '';

            renderPlayers();
            renderPlayerEditLists();
            markUnsaved();
            alert(`${name} added!`);
        }

        function updateWildcardCount() {
            let total = 0;
            wildcards.forEach((_, i) => total += (wildcardsAvailable[i] || 0));
            document.getElementById('wildcardCount').textContent = total;
        }

        // ==========================================
        // CAPTAIN MANAGEMENT
        // ==========================================
        function renderCaptainList() {
            const container = document.getElementById('captainList');
            container.innerHTML = '';

            draftOrder.forEach((captain, index) => {
                const money = captainMoney[captain] || 0;
                const status = captainStatus[captain] || 'active';
                const isCurrentTurn = index === currentTurnIndex;

                let itemClass = 'captain-list-item';
                if (status === 'inactive') itemClass += ' inactive';

                container.innerHTML += `
                    <div class="${itemClass}">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span>${isCurrentTurn ? '→ ' : ''}${index + 1}. ${captain}</span>
                            <span style="color: ${money > 0 ? '#00ff00' : '#ff0000'}; font-size: 0.85em;">${money} YEN</span>
                        </div>
                        <div>
                            <button class="btn-up" onclick="moveCaptain('${captain}', -1)" ${index === 0 ? 'disabled' : ''}>↑</button>
                            <button class="btn-down" onclick="moveCaptain('${captain}', 1)" ${index === draftOrder.length - 1 ? 'disabled' : ''}>↓</button>
                            <button class="btn-skip" onclick="skipCaptainTurn('${captain}')">Skip</button>
                            ${status === 'active'
                                ? `<button class="btn-remove" onclick="toggleCaptainStatus('${captain}')">Off</button>`
                                : `<button class="btn-activate" onclick="toggleCaptainStatus('${captain}')">On</button>`
                            }
                        </div>
                    </div>
                `;
            });
        }

        function addNewCaptain() {
            const name = document.getElementById('newCaptainName').value.trim().toUpperCase();
            if (!name || draftOrder.includes(name)) {
                alert('Enter valid unique name!');
                return;
            }

            draftOrder.push(name);
            captainMoney[name] = 1000;
            captainTeams[name] = [];
            captainStatus[name] = 'active';

            document.getElementById('newCaptainName').value = '';
            renderCaptainList();
            updateTurnDisplay();
            renderTeamsSummary();
            renderRightPanel();
            populateAdminSelectors();
            markUnsaved();
            alert(`Captain ${name} added with 1000 YEN!`);
        }

        function moveCaptain(captain, direction) {
            const currentIndex = draftOrder.indexOf(captain);
            const newIndex = currentIndex + direction;
            if (newIndex < 0 || newIndex >= draftOrder.length) return;

            [draftOrder[currentIndex], draftOrder[newIndex]] = [draftOrder[newIndex], draftOrder[currentIndex]];

            if (currentIndex === currentTurnIndex) currentTurnIndex = newIndex;
            else if (newIndex === currentTurnIndex) currentTurnIndex = currentIndex;

            renderCaptainList();
            updateTurnDisplay();
            renderTeamsSummary();
            markUnsaved();
        }

        function toggleCaptainStatus(captain) {
            captainStatus[captain] = captainStatus[captain] === 'active' ? 'inactive' : 'active';
            if (captainStatus[captain] === 'inactive' && draftOrder[currentTurnIndex] === captain) {
                findNextActiveCaptain();
            }
            renderCaptainList();
            updateTurnDisplay();
            renderTeamsSummary();
            markUnsaved();
        }

        function skipCaptainTurn(captain) {
            if (draftOrder.indexOf(captain) === currentTurnIndex) {
                findNextActiveCaptain();
                renderCaptainList();
                updateTurnDisplay();
                renderTeamsSummary();
                markUnsaved();
            } else {
                alert('Can only skip current captain\'s turn');
            }
        }

        function findNextActiveCaptain() {
            let attempts = 0;
            do {
                currentTurnIndex++;
                if (currentTurnIndex >= draftOrder.length) {
                    currentTurnIndex = 0;
                    roundNumber++;
                }
                attempts++;
                const currentCaptain = draftOrder[currentTurnIndex];
                const isActive = captainStatus[currentCaptain] === 'active';
                const hasMoney = captainMoney[currentCaptain] > 0;
                if (isActive && (!autoSkipNoMoney || hasMoney)) break;
            } while (attempts < draftOrder.length);
        }

        function toggleAutoSkip() {
            autoSkipNoMoney = document.getElementById('autoSkipNoMoney').checked;
            const currentCaptain = getCurrentCaptain();
            if (autoSkipNoMoney && captainMoney[currentCaptain] <= 0) {
                findNextActiveCaptain();
                updateTurnDisplay();
                renderTeamsSummary();
            }
            markUnsaved();
        }

        // ==========================================
        // ROSTER MANAGEMENT
        // ==========================================
        function populateRosterSelectors() {
            const sourceSelect = document.getElementById('rosterSourceTeam');
            const targetSelect = document.getElementById('rosterTargetTeam');

            sourceSelect.innerHTML = '<option value="">Source Team</option>';
            targetSelect.innerHTML = '<option value="">Target Team</option>';

            draftOrder.forEach(captain => {
                const count = (captainTeams[captain] || []).length;
                sourceSelect.innerHTML += `<option value="${captain}">${captain} (${count})</option>`;
                targetSelect.innerHTML += `<option value="${captain}">${captain} (${count})</option>`;
            });

            selectedSourcePlayers = [];
            selectedTargetPlayers = [];
            renderRosterSource();
            renderRosterTarget();
        }

        function renderRosterSource() {
            const team = document.getElementById('rosterSourceTeam').value;
            const container = document.getElementById('rosterSourcePlayers');
            document.getElementById('rosterSourceTitle').textContent = team || 'Source';
            selectedSourcePlayers = [];

            if (!team || !captainTeams[team]) {
                container.innerHTML = '<p style="color: #666;">Select a team</p>';
                return;
            }

            const players = captainTeams[team];
            if (players.length === 0) {
                container.innerHTML = '<p style="color: #666;">No players</p>';
                return;
            }

            container.innerHTML = players.map((player, index) => `
                <div class="roster-player-item" data-index="${index}" onclick="toggleSourcePlayer(${index})">
                    <span>${player.name}</span>
                    <span style="font-size: 0.8em; color: #888;">${player.tier || ''}</span>
                </div>
            `).join('');
        }

        function renderRosterTarget() {
            const team = document.getElementById('rosterTargetTeam').value;
            const container = document.getElementById('rosterTargetPlayers');
            document.getElementById('rosterTargetTitle').textContent = team || 'Target';
            selectedTargetPlayers = [];

            if (!team || !captainTeams[team]) {
                container.innerHTML = '<p style="color: #666;">Select a team</p>';
                return;
            }

            const players = captainTeams[team];
            if (players.length === 0) {
                container.innerHTML = '<p style="color: #666;">No players</p>';
                return;
            }

            container.innerHTML = players.map((player, index) => `
                <div class="roster-player-item" data-index="${index}" onclick="toggleTargetPlayer(${index})">
                    <span>${player.name}</span>
                    <span style="font-size: 0.8em; color: #888;">${player.tier || ''}</span>
                </div>
            `).join('');
        }

        function toggleSourcePlayer(index) {
            const items = document.querySelectorAll('#rosterSourcePlayers .roster-player-item');
            if (selectedSourcePlayers.includes(index)) {
                selectedSourcePlayers = selectedSourcePlayers.filter(i => i !== index);
                items[index].classList.remove('selected');
            } else {
                selectedSourcePlayers.push(index);
                items[index].classList.add('selected');
            }
        }

        function toggleTargetPlayer(index) {
            const items = document.querySelectorAll('#rosterTargetPlayers .roster-player-item');
            if (selectedTargetPlayers.includes(index)) {
                selectedTargetPlayers = selectedTargetPlayers.filter(i => i !== index);
                items[index].classList.remove('selected');
            } else {
                selectedTargetPlayers.push(index);
                items[index].classList.add('selected');
            }
        }

        function moveSelectedToTarget() {
            const sourceTeam = document.getElementById('rosterSourceTeam').value;
            const targetTeam = document.getElementById('rosterTargetTeam').value;

            if (!sourceTeam || !targetTeam || sourceTeam === targetTeam || selectedSourcePlayers.length === 0) {
                alert('Select different teams and players!');
                return;
            }

            const sorted = [...selectedSourcePlayers].sort((a, b) => b - a);
            sorted.forEach(index => {
                const player = captainTeams[sourceTeam][index];
                player.id = `${targetTeam}-${player.purchaseId}-${Date.now()}`;
                captainTeams[targetTeam].push(player);
                captainTeams[sourceTeam].splice(index, 1);
            });

            selectedSourcePlayers = [];
            populateRosterSelectors();
            renderRightPanel();
            markUnsaved();
            alert(`${sorted.length} player(s) moved!`);
        }

        function moveSelectedToSource() {
            const sourceTeam = document.getElementById('rosterSourceTeam').value;
            const targetTeam = document.getElementById('rosterTargetTeam').value;

            if (!sourceTeam || !targetTeam || sourceTeam === targetTeam || selectedTargetPlayers.length === 0) {
                alert('Select different teams and players!');
                return;
            }

            const sorted = [...selectedTargetPlayers].sort((a, b) => b - a);
            sorted.forEach(index => {
                const player = captainTeams[targetTeam][index];
                player.id = `${sourceTeam}-${player.purchaseId}-${Date.now()}`;
                captainTeams[sourceTeam].push(player);
                captainTeams[targetTeam].splice(index, 1);
            });

            selectedTargetPlayers = [];
            populateRosterSelectors();
            renderRightPanel();
            markUnsaved();
            alert(`${sorted.length} player(s) moved!`);
        }

        function moveAllToTarget() {
            const sourceTeam = document.getElementById('rosterSourceTeam').value;
            const targetTeam = document.getElementById('rosterTargetTeam').value;

            if (!sourceTeam || !targetTeam || sourceTeam === targetTeam) {
                alert('Select different teams!');
                return;
            }

            const players = captainTeams[sourceTeam];
            if (players.length === 0 || !confirm(`Move ALL players to ${targetTeam}?`)) return;

            players.forEach(player => {
                player.id = `${targetTeam}-${player.purchaseId}-${Date.now()}`;
                captainTeams[targetTeam].push(player);
            });

            captainTeams[sourceTeam] = [];
            populateRosterSelectors();
            renderRightPanel();
            markUnsaved();
            alert('All players moved!');
        }

        // ==========================================
        // BETTING SYSTEM
        // ==========================================
        function populateBetSelectors() {
            const bet1 = document.getElementById('betTeam1');
            const bet2 = document.getElementById('betTeam2');

            bet1.innerHTML = '<option value="">Team/Person 1</option>';
            bet2.innerHTML = '<option value="">Team/Person 2</option>';

            draftOrder.forEach(captain => {
                const money = captainMoney[captain] || 0;
                bet1.innerHTML += `<option value="${captain}">${captain} (${money} YEN)</option>`;
                bet2.innerHTML += `<option value="${captain}">${captain} (${money} YEN)</option>`;
            });
        }

        function createBet() {
            const team1 = document.getElementById('betTeam1').value;
            const team2 = document.getElementById('betTeam2').value;
            const amount = parseInt(document.getElementById('betAmount').value);
            const description = document.getElementById('betDescription').value.trim();

            if (!team1 || !team2 || team1 === team2 || !amount || amount <= 0) {
                alert('Fill all fields correctly!');
                return;
            }

            bets.push({
                id: betIdCounter++,
                team1, team2, amount,
                description: description || `${team1} vs ${team2}`,
                winner: null, resolved: false,
                createdAt: new Date().toLocaleTimeString()
            });

            document.getElementById('betAmount').value = '';
            document.getElementById('betDescription').value = '';
            renderAdminBetsList();
            markUnsaved();
            alert(`Bet created: ${team1} vs ${team2} for ${amount} YEN`);
        }

        function renderAdminBetsList() {
            const container = document.getElementById('adminBetsList');
            const activeBets = bets.filter(b => !b.resolved);

            if (activeBets.length === 0) {
                container.innerHTML = '<p style="color: #666;">No active bets</p>';
                return;
            }

            container.innerHTML = activeBets.map(bet => `
                <div class="bet-card">
                    <div class="bet-teams">
                        <div class="bet-team">${bet.team1}</div>
                        <div class="bet-vs">VS</div>
                        <div class="bet-team">${bet.team2}</div>
                    </div>
                    <div class="bet-amount">${bet.amount} YEN</div>
                    ${bet.description ? `<p style="font-size: 0.85em; color: #aaa; text-align: center;">${bet.description}</p>` : ''}
                    <div class="bet-controls">
                        <button class="bet-win-1" onclick="resolveBet(${bet.id}, '${bet.team1}')">${bet.team1} Wins</button>
                        <button class="bet-win-2" onclick="resolveBet(${bet.id}, '${bet.team2}')">${bet.team2} Wins</button>
                        <button class="bet-cancel" onclick="cancelBet(${bet.id})">X</button>
                    </div>
                </div>
            `).join('');
        }

        function resolveBet(betId, winner) {
            const betIndex = bets.findIndex(b => b.id === betId);
            if (betIndex === -1) return;

            const bet = bets[betIndex];
            if (!confirm(`Confirm ${winner} won and receives ${bet.amount} YEN?`)) return;

            captainMoney[winner] = (captainMoney[winner] || 0) + bet.amount;
            bet.winner = winner;
            bet.resolved = true;
            bet.resolvedAt = new Date().toLocaleTimeString();

            betsHistory.push(bet);
            bets.splice(betIndex, 1);

            // Add to match history
            matchHistory.push({
                id: Date.now(),
                team1: bet.team1,
                team2: bet.team2,
                winner: winner,
                loser: winner === bet.team1 ? bet.team2 : bet.team1,
                type: 'bet',
                amount: bet.amount,
                timestamp: new Date().toISOString()
            });

            renderAdminBetsList();
            populateBetSelectors();
            updateTurnDisplay();
            renderTeamsSummary();
            renderRightPanel();
            markUnsaved();
            alert(`${winner} received ${bet.amount} YEN!`);
        }

        function cancelBet(betId) {
            const betIndex = bets.findIndex(b => b.id === betId);
            if (betIndex === -1) return;
            if (!confirm('Cancel this bet?')) return;
            bets.splice(betIndex, 1);
            renderAdminBetsList();
            markUnsaved();
        }

        // ==========================================
        // PUBLIC BETTING VIEW
        // ==========================================
        function renderPublicBets() {
            const listContainer = document.getElementById('publicBetsList');
            const historyContainer = document.getElementById('publicBetsHistory');

            const activeBets = bets.filter(b => !b.resolved);

            if (activeBets.length === 0) {
                listContainer.innerHTML = '<p style="color: #666;">No active bets at the moment</p>';
            } else {
                listContainer.innerHTML = activeBets.map(bet => `
                    <div class="bet-card">
                        <div class="bet-teams">
                            <div class="bet-team">${bet.team1}</div>
                            <div class="bet-vs">VS</div>
                            <div class="bet-team">${bet.team2}</div>
                        </div>
                        <div class="bet-amount">${bet.amount} YEN</div>
                        <p style="font-size: 0.85em; color: #aaa; text-align: center;">${bet.description}</p>
                        <p style="font-size: 0.8em; color: #666; text-align: center;">Created: ${bet.createdAt}</p>
                    </div>
                `).join('');
            }

            if (betsHistory.length === 0) {
                historyContainer.innerHTML = '<p style="color: #666;">No completed bets yet</p>';
            } else {
                historyContainer.innerHTML = betsHistory.slice(-10).reverse().map(bet => `
                    <div class="bet-card resolved">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span><strong>${bet.team1}</strong> vs <strong>${bet.team2}</strong></span>
                            <span style="color: #00ff00;">${bet.winner} WON ${bet.amount} YEN</span>
                        </div>
                    </div>
                `).join('');
            }
        }

        function renderBettingTeams() {
            const container = document.getElementById('bettingTeamsPanel');
            container.innerHTML = '';

            const standings = draftOrder.map(team => ({
                team,
                money: captainMoney[team] || 0,
                players: (captainTeams[team] || []).length,
                wins: matchHistory.filter(m => m.winner === team).length,
                losses: matchHistory.filter(m => m.loser === team).length
            })).sort((a, b) => b.wins - a.wins || b.money - a.money);

            standings.forEach((s, i) => {
                container.innerHTML += `
                    <div class="team-card">
                        <h4>#${i + 1} ${s.team}</h4>
                        <div class="team-card-money">${s.money} YEN</div>
                        <div style="font-size: 0.9em;">
                            Players: ${s.players} | W: ${s.wins} | L: ${s.losses}
                        </div>
                    </div>
                `;
            });
        }

        // ==========================================
        // MATCH TRACKING
        // ==========================================
        function renderMatchHistory() {
            const container = document.getElementById('matchHistory');

            if (matchHistory.length === 0) {
                container.innerHTML = '<p style="color: #666;">No matches recorded yet</p>';
                return;
            }

            container.innerHTML = matchHistory.slice(-20).reverse().map(match => {
                const winClass = match.winner === match.team1 ? 'team1-win' : 'team2-win';
                return `
                    <div class="match-item completed ${winClass}">
                        <div class="match-teams">
                            <span class="match-team-name" style="${match.winner === match.team1 ? 'color: #00ff00;' : ''}">${match.team1}</span>
                            <span style="color: #666;">vs</span>
                            <span class="match-team-name" style="${match.winner === match.team2 ? 'color: #00ff00;' : ''}">${match.team2}</span>
                        </div>
                        <div class="match-result">Winner: ${match.winner} ${match.amount ? `(+${match.amount} YEN)` : ''}</div>
                    </div>
                `;
            }).join('');
        }

        function renderTeamStats() {
            const container = document.getElementById('teamStatsPanel');

            const stats = draftOrder.map(team => ({
                team,
                wins: matchHistory.filter(m => m.winner === team).length,
                losses: matchHistory.filter(m => m.loser === team).length,
                money: captainMoney[team] || 0
            })).sort((a, b) => b.wins - a.wins);

            container.innerHTML = stats.map((s, i) => `
                <div class="team-card" style="border-left-color: ${i === 0 ? '#00ff00' : '#ffcc00'};">
                    <h4>#${i + 1} ${s.team}</h4>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #00ff00;">Wins: ${s.wins}</span>
                        <span style="color: #ff6666;">Losses: ${s.losses}</span>
                        <span style="color: #ffcc00;">${s.money} YEN</span>
                    </div>
                </div>
            `).join('');
        }

        function renderMatchesTeams() {
            const container = document.getElementById('matchesTeamsPanel');
            container.innerHTML = '';

            draftOrder.forEach(captain => {
                const team = captainTeams[captain] || [];
                container.innerHTML += `
                    <div class="team-card">
                        <h4>${captain}</h4>
                        <div class="team-card-money">${captainMoney[captain] || 0} YEN</div>
                        <div class="team-players">
                            ${team.length === 0 ? '<span style="color: #666;">No players</span>' :
                                team.map(p => `<div class="player-entry"><span>${p.name}</span><span style="color: #888;">${p.tier || ''}</span></div>`).join('')
                            }
                        </div>
                    </div>
                `;
            });
        }

        // ==========================================
        // RIGHT PANEL
        // ==========================================
        function renderRightPanel() {
            renderTeamsPanel();
        }

        function renderTeamsPanel() {
            const panel = document.getElementById('teamsPanel');
            panel.innerHTML = '<h3 style="color: #ffcc00; margin-bottom: 12px;">TEAMS</h3>';

            draftOrder.forEach(captain => {
                const team = captainTeams[captain] || [];
                const teamDiv = document.createElement('div');
                teamDiv.className = 'team-card';

                let html = `<h4>${captain}</h4>`;
                html += `<div class="team-card-money">${captainMoney[captain] || 0} YEN</div>`;

                if (team.length === 0) {
                    html += '<div style="font-size: 0.9em; color: #999;">No players</div>';
                } else {
                    html += '<div class="team-players">';
                    team.forEach(player => {
                        const status = cardStatus[player.id] || 'active';
                        html += `
                            <div class="player-entry">
                                <span>${player.name} ${player.tier ? `(${player.tier})` : ''}</span>
                                <span class="card-status ${status}" onclick="toggleCardStatus('${player.id}')">${status}</span>
                            </div>
                        `;
                    });
                    html += '</div>';
                }

                teamDiv.innerHTML = html;
                panel.appendChild(teamDiv);
            });
        }

        function toggleCardStatus(playerId) {
            const statuses = ['active', 'used', 'unavailable'];
            const currentIndex = statuses.indexOf(cardStatus[playerId] || 'active');
            cardStatus[playerId] = statuses[(currentIndex + 1) % statuses.length];
            renderTeamsPanel();
            markUnsaved();
        }

        // ==========================================
        // TOURNAMENT FUNCTIONS
        // ==========================================
        function manualTournamentSetup() {
            switchMainView('tournament');
            showTournamentSetup();
        }

        function showTournamentSetup() {
            const container = document.getElementById('tournamentContainer');
            const teams = draftOrder.filter(t => (captainTeams[t] || []).length > 0);

            let html = `
                <div class="tournament-section">
                    <h3>TOURNAMENT SETUP</h3>
                    <div style="margin-bottom: 20px;">
            `;

            teams.forEach((team, idx) => {
                html += `<div style="background: #333; padding: 10px; margin-bottom: 8px; border-left: 3px solid #ffcc00;">
                    <strong>${idx + 1}. ${team}</strong> - ${captainTeams[team].length} Players
                </div>`;
            });

            html += `</div><h4 style="color: #ffcc00; margin: 20px 0;">Build Your Bracket:</h4><div id="bracketBuilder"></div>`;
            html += `<button onclick="startTournament()" style="width: 100%; padding: 12px; margin-top: 20px; background: #00ff00; color: #000; font-weight: bold; cursor: pointer; border: none;">START TOURNAMENT</button>`;
            html += `</div>`;

            container.innerHTML = html;

            const bracketBuilder = document.getElementById('bracketBuilder');
            const numMatches = Math.ceil(teams.length / 2);

            for (let i = 0; i < numMatches; i++) {
                bracketBuilder.innerHTML += `
                    <div style="background: #1a1a1a; border: 2px solid #555; padding: 12px; margin-bottom: 12px;">
                        <div style="margin-bottom: 10px; font-weight: bold;">MATCH ${i + 1}</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <select class="match-team-select" data-match="${i}" data-slot="team1">
                                <option value="">Select Team 1</option>
                                ${teams.map(t => `<option value="${t}">${t}</option>`).join('')}
                            </select>
                            <select class="match-team-select" data-match="${i}" data-slot="team2">
                                <option value="">Select Team 2</option>
                                ${teams.map(t => `<option value="${t}">${t}</option>`).join('')}
                            </select>
                        </div>
                    </div>
                `;
            }

            window.tournamentTeams = teams;
        }

        function startTournament() {
            const matches = document.querySelectorAll('.match-team-select');
            const processedMatches = new Map();

            matches.forEach(select => {
                const matchNum = parseInt(select.getAttribute('data-match'));
                const slot = select.getAttribute('data-slot');
                if (!processedMatches.has(matchNum)) processedMatches.set(matchNum, { team1: null, team2: null });
                processedMatches.get(matchNum)[slot] = select.value;
            });

            tournamentMatches = [];
            processedMatches.forEach((match) => {
                if (match.team1 && match.team2 && match.team1 !== match.team2) {
                    tournamentMatches.push({ team1: match.team1, team2: match.team2, winner: null, round: 1 });
                }
            });

            if (tournamentMatches.length === 0) {
                alert('Please setup valid matches!');
                return;
            }

            duels = tournamentMatches.map(match => ({
                team1: match.team1, team2: match.team2,
                winner: null, loser: null, completed: false,
                sub1: null, sub2: null
            }));

            currentDuelIndex = 0;
            duelHistory = [];
            currentView = 'tournament';
            renderTournamentView();
            markUnsaved();
        }

        function renderTournamentView() {
            const container = document.getElementById('tournamentContainer');

            if (duels.length === 0) {
                showTournamentSetup();
                return;
            }

            let html = `
                <div class="nav-buttons" style="margin-bottom: 15px;">
                    <button class="nav-btn" onclick="showTournamentSetup()">NEW SETUP</button>
                    <button class="nav-btn" onclick="finishTournament()">FINISH</button>
                </div>
                <div class="tournament-info">
                    <h4>TOURNAMENT: ${tournamentName}</h4>
                    <input type="text" class="tournament-input" value="${tournamentName}"
                        onchange="tournamentName = this.value; markUnsaved();" placeholder="Tournament Name">
                    <div style="color: #00ff00;">Duel ${Math.min(currentDuelIndex + 1, duels.length)} of ${duels.length}</div>
                </div>
                <div id="currentDuelContainer"></div>
                <div id="duelHistoryContainer"></div>
            `;

            container.innerHTML = html;

            if (currentDuelIndex < duels.length) {
                renderCurrentDuel();
            } else {
                document.getElementById('currentDuelContainer').innerHTML =
                    '<div style="background: #1a3a1a; padding: 12px; border: 2px solid #00ff00; text-align: center; color: #00ff00; font-weight: bold;">All Duels Complete!</div>';
            }

            renderDuelHistory();
        }

        function renderCurrentDuel() {
            if (currentDuelIndex >= duels.length) return;
            const duel = duels[currentDuelIndex];
            const container = document.getElementById('currentDuelContainer');

            container.innerHTML = `
                <div class="duel-card">
                    <div style="margin-bottom: 12px; font-weight: bold; color: #ffcc00; text-align: center;">CURRENT DUEL</div>
                    <div class="duel-vs">
                        <div class="duel-team">${duel.team1}${duel.sub1 ? ` (${duel.sub1})` : ''}</div>
                        <div class="duel-vs-text">VS</div>
                        <div class="duel-team">${duel.team2}${duel.sub2 ? ` (${duel.sub2})` : ''}</div>
                    </div>
                    <div class="duel-controls">
                        <button class="winner-btn" onclick="completeDuel('${duel.team1}')">${duel.team1} Wins</button>
                        <button class="loser-btn" onclick="completeDuel('${duel.team2}')">${duel.team2} Wins</button>
                    </div>
                </div>
            `;
        }

        function completeDuel(winner) {
            if (currentDuelIndex >= duels.length) return;

            const duel = duels[currentDuelIndex];
            duel.winner = winner;
            duel.loser = winner === duel.team1 ? duel.team2 : duel.team1;
            duel.completed = true;

            duelHistory.push({
                duelNum: duelHistory.length + 1,
                team1: duel.team1, team2: duel.team2,
                winner: winner, sub1: duel.sub1, sub2: duel.sub2
            });

            matchHistory.push({
                id: Date.now(),
                team1: duel.team1, team2: duel.team2,
                winner: winner, loser: duel.loser,
                type: 'tournament',
                timestamp: new Date().toISOString()
            });

            currentDuelIndex++;
            renderTournamentView();
            markUnsaved();
        }

        function renderDuelHistory() {
            const container = document.getElementById('duelHistoryContainer');
            if (!container || duelHistory.length === 0) return;

            container.innerHTML = '<div style="margin-top: 15px;"><strong style="color: #00ff00;">Completed Duels:</strong>' +
                duelHistory.map(entry =>
                    `<div class="duel-history">#${entry.duelNum}: ${entry.team1} vs ${entry.team2} → <span style="color: #00ff00; font-weight: bold;">${entry.winner} WIN</span></div>`
                ).join('') + '</div>';
        }

        function finishTournament() {
            if (duelHistory.length === 0) {
                alert('Complete at least one duel!');
                return;
            }

            const standings = draftOrder.map(team => ({
                team,
                wins: duelHistory.filter(d => d.winner === team).length,
                losses: duelHistory.filter(d => (d.team1 === team || d.team2 === team) && d.winner !== team).length
            })).sort((a, b) => b.wins - a.wins);

            let html = `<h2 style="text-align: center; color: #00ff00; margin-bottom: 20px;">${tournamentName.toUpperCase()} - FINAL RESULTS</h2>`;

            standings.forEach((s, i) => {
                const medal = i === 0 ? '1st' : i === 1 ? '2nd' : i === 2 ? '3rd' : `${i + 1}th`;
                html += `
                    <div class="team-final" style="border-left-color: ${i === 0 ? '#ffcc00' : '#888'};">
                        <h3>${medal} - ${s.team}</h3>
                        <div>Wins: ${s.wins} | Losses: ${s.losses}</div>
                    </div>
                `;
            });

            html += `<button onclick="showTournamentSetup()" style="width: 100%; padding: 12px; margin-top: 15px; background: #00aa00; color: #fff; border: none; cursor: pointer; font-weight: bold;">NEW TOURNAMENT</button>`;

            document.getElementById('tournamentContainer').innerHTML = html;
            saveAllData();
        }

        // ==========================================
        // INITIALIZE
        // ==========================================
        document.addEventListener('DOMContentLoaded', initializeGame);

        // Handle Enter key in login
        document.getElementById('loginPass').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') attemptLogin();
        });
    </script>
</body>
</html>
