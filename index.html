<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUNRISE CITY SLAMDOWN - Tournament Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
            min-height: 100vh;
        }

        /* Navigation */
        .top-nav {
            background: #2a2a2a;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #444;
        }

        .nav-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #ffcc00;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: 2px solid #555;
            background: #333;
            color: #fff;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .nav-btn:hover {
            background: #444;
            border-color: #ffcc00;
        }

        .nav-btn.active {
            background: #ffcc00;
            color: #000;
            border-color: #ffcc00;
        }

        /* Login Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-box {
            background: #2a2a2a;
            padding: 30px;
            border: 3px solid #ffcc00;
            border-radius: 10px;
            min-width: 350px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-box h2 {
            color: #ffcc00;
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            background: #333;
            color: #fff;
            border: 1px solid #555;
            font-size: 1em;
        }

        .modal-btn {
            width: 100%;
            padding: 12px;
            background: #00ff00;
            color: #000;
            border: none;
            font-weight: bold;
            cursor: pointer;
            font-size: 1em;
            margin-bottom: 10px;
        }

        .modal-btn:hover {
            background: #00dd00;
        }

        .modal-btn.cancel {
            background: #666;
            color: #fff;
        }

        .modal-btn.danger {
            background: #aa0000;
            color: #fff;
        }

        /* Main Container */
        .main-container {
            display: none;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .main-container.active {
            display: block;
        }

        /* Admin Panel */
        .admin-grid {
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            gap: 20px;
        }

        .admin-section {
            background: #2a2a2a;
            border: 2px solid #444;
            padding: 15px;
        }

        .admin-section h3 {
            color: #ffcc00;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }

        /* Captain Selector */
        .captain-selector {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .captain-item {
            padding: 12px;
            background: #333;
            border: 2px solid #555;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .captain-item:hover {
            border-color: #ffcc00;
        }

        .captain-item.selected {
            background: #444400;
            border-color: #ffcc00;
        }

        .captain-money {
            color: #00ff00;
            font-weight: bold;
        }

        .captain-players-count {
            color: #888;
            font-size: 0.85em;
        }

        /* Players Grid */
        .players-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .player-category {
            background: #333;
            padding: 15px;
            border-left: 4px solid #ffcc00;
        }

        .player-category h4 {
            color: #ffcc00;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
        }

        .player-card {
            background: #444;
            padding: 10px;
            border: 2px solid #555;
            cursor: pointer;
            transition: all 0.3s;
        }

        .player-card:hover {
            border-color: #00ff00;
            background: #4a4a4a;
        }

        .player-card.assigned {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .player-card.unavailable {
            background: #3a2020;
            border-color: #aa0000;
        }

        .player-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .player-tier {
            display: inline-block;
            padding: 2px 6px;
            background: #555;
            font-size: 0.8em;
            margin-bottom: 5px;
        }

        .player-price {
            color: #00ff00;
            font-weight: bold;
        }

        .player-count {
            color: #ffcc00;
            font-size: 0.85em;
        }

        /* Teams Panel */
        .teams-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .team-card {
            background: #333;
            border: 2px solid #555;
            padding: 12px;
        }

        .team-card h4 {
            color: #ffcc00;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }

        .team-money {
            color: #00ff00;
        }

        .team-player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 8px;
            background: #444;
            margin-bottom: 4px;
            border-left: 3px solid #666;
        }

        .team-player.active {
            border-left-color: #00ff00;
        }

        .team-player.used {
            border-left-color: #ff9900;
        }

        .team-player.unavailable {
            border-left-color: #aa0000;
            background: #3a2020;
        }

        .remove-player-btn {
            background: #aa0000;
            color: #fff;
            border: none;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 0.8em;
        }

        .card-status-btn {
            background: #555;
            color: #fff;
            border: none;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 0.75em;
            margin-left: 4px;
        }

        /* Admin Controls */
        .admin-controls-section {
            background: #1a1a1a;
            border: 2px solid #ffcc00;
            padding: 15px;
            margin-bottom: 15px;
        }

        .admin-controls-section h4 {
            color: #ffcc00;
            margin-bottom: 12px;
        }

        .control-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .control-row input,
        .control-row select {
            flex: 1;
            padding: 8px;
            background: #333;
            color: #fff;
            border: 1px solid #555;
        }

        .control-row button {
            padding: 8px 15px;
            background: #00ff00;
            color: #000;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }

        .control-row button.danger {
            background: #aa0000;
            color: #fff;
        }

        /* Matches Panel */
        .matches-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .match-card {
            background: #333;
            border: 2px solid #555;
            padding: 15px;
        }

        .match-card.active {
            border-color: #00ff00;
            background: #1a3a1a;
        }

        .match-card.completed {
            opacity: 0.7;
        }

        .match-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .match-team {
            flex: 1;
            text-align: center;
            padding: 10px;
            background: #444;
            font-weight: bold;
        }

        .match-team.winner {
            background: #00aa00;
        }

        .match-vs {
            padding: 0 15px;
            color: #ffcc00;
            font-weight: bold;
        }

        .match-controls {
            display: flex;
            gap: 10px;
        }

        .match-controls button {
            flex: 1;
            padding: 10px;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }

        .btn-win {
            background: #00aa00;
            color: #fff;
        }

        /* Betting Panel */
        .betting-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .bet-section {
            background: #2a2a2a;
            border: 2px solid #ff9900;
            padding: 15px;
        }

        .bet-section h3 {
            color: #ff9900;
            margin-bottom: 15px;
        }

        .bet-card {
            background: #333;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 3px solid #ff9900;
        }

        .bet-card.won {
            border-left-color: #00ff00;
        }

        .bet-card.lost {
            border-left-color: #aa0000;
        }

        .current-match-bet {
            background: #1a3a1a;
            border: 2px solid #00ff00;
            padding: 20px;
            margin-bottom: 15px;
            text-align: center;
        }

        .bet-option {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .bet-option button {
            flex: 1;
            padding: 15px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
        }

        /* Stats Panel */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .stat-card {
            background: #333;
            padding: 15px;
            border-left: 3px solid #0099ff;
        }

        .stat-card h4 {
            color: #0099ff;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #00ff00;
        }

        /* Player Edit Modal */
        .edit-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 8px;
            margin-bottom: 8px;
            padding: 8px;
            background: #333;
        }

        .edit-row input {
            padding: 6px;
            background: #444;
            color: #fff;
            border: 1px solid #555;
        }

        .edit-row button {
            padding: 6px 10px;
            background: #aa0000;
            color: #fff;
            border: none;
            cursor: pointer;
        }

        /* Unavailable Section */
        .unavailable-section {
            background: #2a1a1a;
            border: 2px solid #aa0000;
            padding: 15px;
            margin-top: 15px;
        }

        .unavailable-section h4 {
            color: #aa0000;
            margin-bottom: 10px;
        }

        /* Card Usage Stats */
        .usage-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .usage-stat {
            background: #333;
            padding: 8px;
            text-align: center;
        }

        .usage-stat .count {
            font-size: 1.3em;
            font-weight: bold;
            color: #ffcc00;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .admin-grid {
                grid-template-columns: 1fr;
            }
            .betting-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #555;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div id="loginModal" class="modal-overlay" style="display: none;">
        <div class="modal-box">
            <h2>ADMIN LOGIN</h2>
            <input type="text" class="modal-input" id="loginUsername" placeholder="Username">
            <input type="password" class="modal-input" id="loginPassword" placeholder="Password">
            <button class="modal-btn" onclick="attemptLogin()">LOGIN</button>
            <button class="modal-btn cancel" onclick="closeLoginModal()">Cancel</button>
            <p id="loginError" style="color: #ff0000; margin-top: 10px; text-align: center;"></p>
        </div>
    </div>

    <!-- Player Edit Modal -->
    <div id="playerEditModal" class="modal-overlay" style="display: none;">
        <div class="modal-box" style="min-width: 600px;">
            <h2>EDIT PLAYERS & CARDS</h2>
            <div id="playerEditContent"></div>
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="modal-btn" onclick="addNewPlayer('wildcard')">+ Add Wild Card</button>
                <button class="modal-btn" onclick="addNewPlayer('tsuguko')">+ Add Tsuguko</button>
                <button class="modal-btn" onclick="addNewPlayer('hinoe')">+ Add Hinoe</button>
            </div>
            <button class="modal-btn cancel" style="margin-top: 15px;" onclick="closePlayerEditModal()">Close</button>
        </div>
    </div>

    <!-- Add Captain Modal -->
    <div id="addCaptainModal" class="modal-overlay" style="display: none;">
        <div class="modal-box">
            <h2>ADD NEW CAPTAIN</h2>
            <input type="text" class="modal-input" id="newCaptainName" placeholder="Captain Name">
            <input type="number" class="modal-input" id="newCaptainMoney" placeholder="Starting Money (default: 1000)" value="1000">
            <button class="modal-btn" onclick="confirmAddCaptain()">Add Captain</button>
            <button class="modal-btn cancel" onclick="closeAddCaptainModal()">Cancel</button>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="top-nav">
        <div class="nav-title">SUNRISE CITY SLAMDOWN</div>
        <div class="nav-buttons">
            <button class="nav-btn" id="navAdmin" onclick="showAdminLogin()">ADMIN</button>
            <button class="nav-btn" id="navBetting" onclick="switchView('betting')">BETTING</button>
            <button class="nav-btn" id="navSpectator" onclick="switchView('spectator')">SPECTATOR</button>
        </div>
    </nav>

    <!-- Admin Panel -->
    <div id="adminPanel" class="main-container">
        <div class="admin-grid">
            <!-- Left: Captain Selection & Controls -->
            <div>
                <div class="admin-section">
                    <h3>SELECT CAPTAIN</h3>
                    <p style="color: #aaa; font-size: 0.85em; margin-bottom: 10px;">Click a captain, then click a player to add them</p>
                    <div class="captain-selector" id="captainSelector"></div>
                    <button class="modal-btn" style="margin-top: 15px;" onclick="openAddCaptainModal()">+ Add New Captain</button>
                </div>

                <div class="admin-controls-section" style="margin-top: 15px;">
                    <h4>QUICK ACTIONS</h4>
                    <div class="control-row">
                        <select id="adminCaptainSelect">
                            <option value="">Select Captain</option>
                        </select>
                        <input type="number" id="addMoneyAmount" placeholder="Amount">
                        <button onclick="addMoney()">Add Money</button>
                    </div>
                    <div class="control-row">
                        <button onclick="openPlayerEditModal()" style="width: 100%;">Edit All Players & Prices</button>
                    </div>
                    <div class="control-row">
                        <button onclick="setupMatches()" style="width: 100%; background: #0099ff;">Setup Matches</button>
                    </div>
                    <div class="control-row">
                        <button onclick="resetAllData()" class="danger" style="width: 100%;">Reset All Data</button>
                    </div>
                </div>
            </div>

            <!-- Center: Players -->
            <div class="admin-section">
                <h3>AVAILABLE PLAYERS <span id="selectedCaptainDisplay" style="color: #00ff00;"></span></h3>
                <div class="players-container" id="playersContainer"></div>

                <!-- Unavailable Players -->
                <div class="unavailable-section" id="unavailableSection" style="display: none;">
                    <h4>UNAVAILABLE PLAYERS (Cannot Fight)</h4>
                    <div id="unavailablePlayers"></div>
                </div>
            </div>

            <!-- Right: Teams -->
            <div class="admin-section">
                <h3>TEAMS</h3>
                <div class="teams-panel" id="teamsPanel"></div>
            </div>
        </div>

        <!-- Matches Section -->
        <div class="admin-section" style="margin-top: 20px;">
            <h3>MATCHES</h3>
            <div class="matches-container" id="matchesContainer"></div>
        </div>

        <!-- Card Usage Stats -->
        <div class="admin-section" style="margin-top: 20px;">
            <h3>CARD USAGE STATISTICS</h3>
            <div class="usage-stats" id="usageStats"></div>
        </div>
    </div>

    <!-- Betting Panel -->
    <div id="bettingPanel" class="main-container">
        <h2 style="color: #ff9900; margin-bottom: 20px;">BETTING CENTER</h2>
        <div class="betting-grid">
            <div>
                <div class="bet-section">
                    <h3>CURRENT MATCH</h3>
                    <div id="currentMatchBet"></div>
                </div>

                <div class="bet-section" style="margin-top: 20px;">
                    <h3>PLACE YOUR BET</h3>
                    <div class="control-row">
                        <input type="text" id="bettorName" placeholder="Your Name">
                    </div>
                    <div class="control-row">
                        <input type="number" id="betAmount" placeholder="Bet Amount">
                    </div>
                    <div id="betOptions"></div>
                </div>
            </div>

            <div>
                <div class="bet-section">
                    <h3>ACTIVE BETS</h3>
                    <div id="activeBetsList"></div>
                </div>

                <div class="bet-section" style="margin-top: 20px;">
                    <h3>BET HISTORY</h3>
                    <div id="betHistory"></div>
                </div>
            </div>
        </div>

        <!-- All Teams View for Bettors -->
        <div class="admin-section" style="margin-top: 20px;">
            <h3>TEAM STANDINGS</h3>
            <div class="stats-grid" id="teamStandingsBetting"></div>
        </div>
    </div>

    <!-- Spectator Panel -->
    <div id="spectatorPanel" class="main-container">
        <h2 style="color: #0099ff; margin-bottom: 20px;">SPECTATOR VIEW</h2>

        <div class="betting-grid">
            <div>
                <div class="bet-section" style="border-color: #0099ff;">
                    <h3 style="color: #0099ff;">LIVE MATCHES</h3>
                    <div id="liveMatches"></div>
                </div>

                <div class="bet-section" style="margin-top: 20px; border-color: #0099ff;">
                    <h3 style="color: #0099ff;">MATCH HISTORY</h3>
                    <div id="matchHistory"></div>
                </div>
            </div>

            <div>
                <div class="bet-section" style="border-color: #0099ff;">
                    <h3 style="color: #0099ff;">TEAM STANDINGS</h3>
                    <div id="teamStandings"></div>
                </div>

                <div class="bet-section" style="margin-top: 20px; border-color: #0099ff;">
                    <h3 style="color: #0099ff;">CARD USAGE</h3>
                    <div id="cardUsageSpectator"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // DATA STRUCTURES
        // ==========================================
        let gameData = {
            captains: ['JUAN', 'RIOT', 'TACK', 'GLORY', 'SIMON', 'JUSTIN'],
            captainMoney: {},
            captainTeams: {},
            wildcards: [
                { name: 'WILD CARD (MYTHICAL)', price: 1000, count: 3, available: 3 },
                { name: 'WILD CARD (LEGENDARY)', price: 500, count: 3, available: 3 },
                { name: 'WILD CARD (RARE)', price: 250, count: 3, available: 3 }
            ],
            tsugukos: [
                { name: 'UBUME', tier: 'B', price: 400 },
                { name: 'AIDAN', tier: 'B', price: 300 },
                { name: 'BEN', tier: 'A-', price: 300 },
                { name: 'GIAN', tier: 'A-', price: 300 },
                { name: 'HEISEI', tier: 'A+', price: 375 },
                { name: 'JACOB', tier: 'A-', price: 300 },
                { name: 'KAZUO', tier: 'C+', price: 400 },
                { name: 'MAT', tier: 'S', price: 425 },
                { name: 'MIKAMI', tier: 'S+', price: 400 },
                { name: 'MIKU', tier: 'A', price: 450 },
                { name: 'MIZUIRO', tier: 'B-', price: 300 },
                { name: 'POG', tier: 'B', price: 300 },
                { name: 'REL', tier: 'S', price: 425 },
                { name: 'LUNAR', tier: 'S+', price: 400 },
                { name: 'LIGHT', tier: 'C', price: 300 },
                { name: 'SEV', tier: 'B', price: 350 },
                { name: 'SOUL', tier: 'A-', price: 300 },
                { name: 'STEFAN', tier: 'F+', price: 300 },
                { name: 'CLOUD', tier: 'S', price: 375 },
                { name: 'TSUYA', tier: 'C-', price: 350 },
                { name: 'YAMI', tier: 'D+', price: 300, special: 'BUY 1 GET A HINOE FOR FREE' },
                { name: 'ZAYA', tier: 'B+', price: 300 },
                { name: 'CRUZ', tier: 'B', price: 300 },
                { name: 'BEEFY', tier: 'S+', price: 1000 }
            ],
            hinoes: [
                { name: 'MOZART', price: 150 },
                { name: 'ALON MOR', price: 150 },
                { name: 'SPONGEBOB', price: 150 },
                { name: 'BLANCHE', price: 150 },
                { name: 'AYAKA', price: 150 },
                { name: 'BACONLAD', price: 150 },
                { name: 'DARK', price: 150 },
                { name: 'COMMTON', price: 150 },
                { name: 'ETHAN', price: 150 },
                { name: 'GIN', price: 150 },
                { name: 'REMOVE', price: 150 },
                { name: 'HINO', price: 150 },
                { name: 'HOLY', price: 150 },
                { name: 'ISAKI', price: 150 },
                { name: 'JOHN PICKLER', price: 150 },
                { name: 'AKARI', price: 150 },
                { name: 'KUTA', price: 150 },
                { name: 'LOGAN', price: 150 },
                { name: 'MAKOTO', price: 150 },
                { name: 'MAZE', price: 150 },
                { name: 'JAYCAR', price: 150 },
                { name: 'PANDA', price: 150 },
                { name: 'AKIO', price: 150 },
                { name: 'MERO', price: 700 },
                { name: 'ZARETH', price: 250 },
                { name: 'SAIN', price: 200 },
                { name: 'GROOVY', price: 300 }
            ],
            assignedPlayers: {}, // { playerId: captainName }
            playerStatus: {}, // { playerId: 'active'|'used'|'unavailable' }
            cardUsageCount: {}, // { playerName: count }
            matches: [],
            matchHistory: [],
            bets: [],
            betHistory: [],
            unavailablePlayers: [] // Players who can't fight
        };

        let selectedCaptain = null;
        let isAdminLoggedIn = false;
        let currentView = 'spectator';
        let currentMatchIndex = 0;

        // ==========================================
        // LOCAL STORAGE
        // ==========================================
        function saveData() {
            localStorage.setItem('sunriseCitySlamdown', JSON.stringify(gameData));
        }

        function loadData() {
            const saved = localStorage.getItem('sunriseCitySlamdown');
            if (saved) {
                const parsed = JSON.parse(saved);
                gameData = { ...gameData, ...parsed };
            }
            initializeCaptains();
        }

        function initializeCaptains() {
            gameData.captains.forEach(captain => {
                if (gameData.captainMoney[captain] === undefined) {
                    gameData.captainMoney[captain] = 1000;
                }
                if (!gameData.captainTeams[captain]) {
                    gameData.captainTeams[captain] = [];
                }
            });
        }

        // ==========================================
        // AUTHENTICATION
        // ==========================================
        function showAdminLogin() {
            if (isAdminLoggedIn) {
                switchView('admin');
            } else {
                document.getElementById('loginModal').style.display = 'flex';
            }
        }

        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('loginError').textContent = '';
        }

        function attemptLogin() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            if (username === 'Tack' && password === 'Tack123') {
                isAdminLoggedIn = true;
                closeLoginModal();
                switchView('admin');
            } else {
                document.getElementById('loginError').textContent = 'Invalid credentials!';
            }
        }

        // ==========================================
        // VIEW SWITCHING
        // ==========================================
        function switchView(view) {
            currentView = view;

            // Hide all panels
            document.querySelectorAll('.main-container').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));

            // Show selected panel
            if (view === 'admin' && isAdminLoggedIn) {
                document.getElementById('adminPanel').classList.add('active');
                document.getElementById('navAdmin').classList.add('active');
                renderAdminPanel();
            } else if (view === 'betting') {
                document.getElementById('bettingPanel').classList.add('active');
                document.getElementById('navBetting').classList.add('active');
                renderBettingPanel();
            } else {
                document.getElementById('spectatorPanel').classList.add('active');
                document.getElementById('navSpectator').classList.add('active');
                renderSpectatorPanel();
            }
        }

        // ==========================================
        // ADMIN PANEL RENDERING
        // ==========================================
        function renderAdminPanel() {
            renderCaptainSelector();
            renderPlayersContainer();
            renderTeamsPanel();
            renderMatchesContainer();
            renderUsageStats();
            renderUnavailablePlayers();
            updateAdminCaptainSelect();
        }

        function renderCaptainSelector() {
            const container = document.getElementById('captainSelector');
            container.innerHTML = '';

            gameData.captains.forEach(captain => {
                const money = gameData.captainMoney[captain] || 0;
                const playerCount = (gameData.captainTeams[captain] || []).length;
                const isSelected = selectedCaptain === captain;

                const div = document.createElement('div');
                div.className = `captain-item ${isSelected ? 'selected' : ''}`;
                div.innerHTML = `
                    <div>
                        <strong>${captain}</strong>
                        <div class="captain-players-count">${playerCount} players</div>
                    </div>
                    <div>
                        <span class="captain-money">${money} YEN</span>
                        <button onclick="event.stopPropagation(); removeCaptain('${captain}')" style="background: #aa0000; color: #fff; border: none; padding: 4px 8px; margin-left: 8px; cursor: pointer;">X</button>
                    </div>
                `;
                div.onclick = () => selectCaptain(captain);
                container.appendChild(div);
            });
        }

        function selectCaptain(captain) {
            selectedCaptain = captain;
            document.getElementById('selectedCaptainDisplay').textContent = `- Adding to: ${captain}`;
            renderCaptainSelector();
            renderPlayersContainer();
        }

        function renderPlayersContainer() {
            const container = document.getElementById('playersContainer');
            container.innerHTML = '';

            // Wild Cards
            const wildcardsHtml = renderPlayerCategory('WILD CARDS', gameData.wildcards, 'wildcard', true);
            container.innerHTML += wildcardsHtml;

            // Tsugukos
            const tsugukosHtml = renderPlayerCategory('TSUGUKOS (Max 2 per team)', gameData.tsugukos, 'tsuguko');
            container.innerHTML += tsugukosHtml;

            // Hinoes
            const hinoesHtml = renderPlayerCategory('HINOES', gameData.hinoes, 'hinoe');
            container.innerHTML += hinoesHtml;
        }

        function renderPlayerCategory(title, players, category, isWildcard = false) {
            let html = `<div class="player-category"><h4>${title}</h4><div class="players-grid">`;

            players.forEach((player, index) => {
                const playerId = `${category}-${index}`;
                const isAssigned = gameData.assignedPlayers[playerId];
                const isUnavailable = gameData.unavailablePlayers.includes(playerId);

                if (isWildcard) {
                    const available = player.available || player.count;
                    if (available <= 0) return;

                    html += `
                        <div class="player-card ${selectedCaptain ? '' : 'assigned'}" onclick="assignPlayer('${playerId}', ${index}, '${category}')">
                            <div class="player-name">${player.name}</div>
                            <div class="player-price">${player.price} YEN</div>
                            <div class="player-count">Available: ${available}/${player.count}</div>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="player-card ${isAssigned ? 'assigned' : ''} ${isUnavailable ? 'unavailable' : ''}"
                            onclick="${!isAssigned && !isUnavailable ? `assignPlayer('${playerId}', ${index}, '${category}')` : ''}">
                            <div class="player-name">${player.name}</div>
                            ${player.tier ? `<span class="player-tier">${player.tier}</span>` : ''}
                            <div class="player-price">${player.price} YEN</div>
                            ${player.special ? `<div style="font-size: 0.75em; color: #ffcc00; margin-top: 4px;">${player.special}</div>` : ''}
                            ${isAssigned ? `<div style="color: #888; font-size: 0.8em;">Assigned to: ${isAssigned}</div>` : ''}
                            ${isUnavailable ? `<div style="color: #aa0000; font-size: 0.8em;">UNAVAILABLE</div>` : ''}
                        </div>
                    `;
                }
            });

            html += '</div></div>';
            return html;
        }

        function assignPlayer(playerId, index, category) {
            if (!selectedCaptain) {
                alert('Please select a captain first!');
                return;
            }

            const captain = selectedCaptain;
            let player, price;

            if (category === 'wildcard') {
                player = gameData.wildcards[index];
                if (player.available <= 0) {
                    alert('No more cards available!');
                    return;
                }
            } else if (category === 'tsuguko') {
                player = gameData.tsugukos[index];
                // Check tsuguko limit
                const tsugukoCount = (gameData.captainTeams[captain] || []).filter(p => p.category === 'tsuguko').length;
                if (tsugukoCount >= 2) {
                    alert('Maximum 2 Tsugukos per team!');
                    return;
                }
            } else {
                player = gameData.hinoes[index];
            }

            price = player.price;

            // Check money
            if (gameData.captainMoney[captain] < price) {
                alert('Not enough money!');
                return;
            }

            // Deduct money
            gameData.captainMoney[captain] -= price;

            // Add to team
            const playerData = {
                ...player,
                id: `${captain}-${playerId}-${Date.now()}`,
                playerId: playerId,
                category: category,
                status: 'active'
            };

            if (!gameData.captainTeams[captain]) {
                gameData.captainTeams[captain] = [];
            }
            gameData.captainTeams[captain].push(playerData);

            // Mark as assigned (not for wildcards)
            if (category === 'wildcard') {
                gameData.wildcards[index].available--;
            } else {
                gameData.assignedPlayers[playerId] = captain;
            }

            // YAMI bonus
            if (player.name === 'YAMI') {
                const availableHinoe = gameData.hinoes.findIndex((h, i) => !gameData.assignedPlayers[`hinoe-${i}`]);
                if (availableHinoe !== -1) {
                    const bonusPlayer = gameData.hinoes[availableHinoe];
                    const bonusId = `hinoe-${availableHinoe}`;
                    gameData.captainTeams[captain].push({
                        ...bonusPlayer,
                        id: `${captain}-${bonusId}-bonus`,
                        playerId: bonusId,
                        category: 'hinoe',
                        status: 'active',
                        bonus: true
                    });
                    gameData.assignedPlayers[bonusId] = captain;
                    alert(`BONUS! ${bonusPlayer.name} added for FREE!`);
                }
            }

            saveData();
            renderAdminPanel();
        }

        function renderTeamsPanel() {
            const container = document.getElementById('teamsPanel');
            container.innerHTML = '';

            gameData.captains.forEach(captain => {
                const team = gameData.captainTeams[captain] || [];
                const money = gameData.captainMoney[captain] || 0;

                let html = `
                    <div class="team-card">
                        <h4>
                            <span>${captain}</span>
                            <span class="team-money">${money} YEN</span>
                        </h4>
                `;

                if (team.length === 0) {
                    html += '<div style="color: #888; font-size: 0.9em;">No players</div>';
                } else {
                    team.forEach((player, idx) => {
                        const status = player.status || 'active';
                        html += `
                            <div class="team-player ${status}">
                                <span>${player.name} ${player.tier ? `(${player.tier})` : ''} ${player.bonus ? '[FREE]' : ''}</span>
                                <div>
                                    <button class="card-status-btn" onclick="cyclePlayerStatus('${captain}', ${idx})">${status.toUpperCase()}</button>
                                    <button class="remove-player-btn" onclick="removePlayerFromTeam('${captain}', ${idx})">X</button>
                                </div>
                            </div>
                        `;
                    });
                }

                html += '</div>';
                container.innerHTML += html;
            });
        }

        function cyclePlayerStatus(captain, playerIndex) {
            const team = gameData.captainTeams[captain];
            if (!team || !team[playerIndex]) return;

            const statuses = ['active', 'used', 'unavailable'];
            const currentStatus = team[playerIndex].status || 'active';
            const currentIndex = statuses.indexOf(currentStatus);
            team[playerIndex].status = statuses[(currentIndex + 1) % statuses.length];

            // Track usage
            if (team[playerIndex].status === 'used') {
                const name = team[playerIndex].name;
                gameData.cardUsageCount[name] = (gameData.cardUsageCount[name] || 0) + 1;
            }

            saveData();
            renderTeamsPanel();
            renderUsageStats();
        }

        function removePlayerFromTeam(captain, playerIndex) {
            const team = gameData.captainTeams[captain];
            if (!team || !team[playerIndex]) return;

            const player = team[playerIndex];

            if (!confirm(`Remove ${player.name} from ${captain}'s team?`)) return;

            // Restore wildcard count or unassign player
            if (player.category === 'wildcard') {
                const wcIndex = gameData.wildcards.findIndex(w => w.name === player.name);
                if (wcIndex !== -1) {
                    gameData.wildcards[wcIndex].available++;
                }
            } else {
                delete gameData.assignedPlayers[player.playerId];
            }

            // Remove from team
            team.splice(playerIndex, 1);

            saveData();
            renderAdminPanel();
        }

        function renderUsageStats() {
            const container = document.getElementById('usageStats');
            const entries = Object.entries(gameData.cardUsageCount);

            if (entries.length === 0) {
                container.innerHTML = '<p style="color: #888;">No cards used yet</p>';
                return;
            }

            container.innerHTML = entries.sort((a, b) => b[1] - a[1]).map(([name, count]) => `
                <div class="usage-stat">
                    <div>${name}</div>
                    <div class="count">${count}x used</div>
                </div>
            `).join('');
        }

        function renderUnavailablePlayers() {
            const container = document.getElementById('unavailablePlayers');
            const section = document.getElementById('unavailableSection');

            // Find all unavailable players from teams
            let unavailable = [];
            gameData.captains.forEach(captain => {
                const team = gameData.captainTeams[captain] || [];
                team.forEach(player => {
                    if (player.status === 'unavailable') {
                        unavailable.push({ ...player, captain });
                    }
                });
            });

            if (unavailable.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';
            container.innerHTML = unavailable.map(p => `
                <div class="team-player unavailable">
                    <span>${p.name} (${p.captain})</span>
                    <span style="color: #aa0000;">Cannot fight</span>
                </div>
            `).join('');
        }

        // ==========================================
        // CAPTAIN MANAGEMENT
        // ==========================================
        function openAddCaptainModal() {
            document.getElementById('addCaptainModal').style.display = 'flex';
        }

        function closeAddCaptainModal() {
            document.getElementById('addCaptainModal').style.display = 'none';
        }

        function confirmAddCaptain() {
            const name = document.getElementById('newCaptainName').value.trim().toUpperCase();
            const money = parseInt(document.getElementById('newCaptainMoney').value) || 1000;

            if (!name) {
                alert('Please enter a name!');
                return;
            }

            if (gameData.captains.includes(name)) {
                alert('Captain already exists!');
                return;
            }

            gameData.captains.push(name);
            gameData.captainMoney[name] = money;
            gameData.captainTeams[name] = [];

            saveData();
            closeAddCaptainModal();
            renderAdminPanel();

            alert(`Captain ${name} added with ${money} YEN!`);
        }

        function removeCaptain(captain) {
            if (!confirm(`Remove captain ${captain}? Their players will be unassigned.`)) return;

            // Unassign all players
            const team = gameData.captainTeams[captain] || [];
            team.forEach(player => {
                if (player.category !== 'wildcard') {
                    delete gameData.assignedPlayers[player.playerId];
                } else {
                    const wcIndex = gameData.wildcards.findIndex(w => w.name === player.name);
                    if (wcIndex !== -1) {
                        gameData.wildcards[wcIndex].available++;
                    }
                }
            });

            // Remove captain
            gameData.captains = gameData.captains.filter(c => c !== captain);
            delete gameData.captainMoney[captain];
            delete gameData.captainTeams[captain];

            if (selectedCaptain === captain) {
                selectedCaptain = null;
                document.getElementById('selectedCaptainDisplay').textContent = '';
            }

            saveData();
            renderAdminPanel();
        }

        function updateAdminCaptainSelect() {
            const select = document.getElementById('adminCaptainSelect');
            select.innerHTML = '<option value="">Select Captain</option>';
            gameData.captains.forEach(captain => {
                select.innerHTML += `<option value="${captain}">${captain} (${gameData.captainMoney[captain]} YEN)</option>`;
            });
        }

        function addMoney() {
            const captain = document.getElementById('adminCaptainSelect').value;
            const amount = parseInt(document.getElementById('addMoneyAmount').value);

            if (!captain) {
                alert('Select a captain!');
                return;
            }
            if (!amount || amount <= 0) {
                alert('Enter a valid amount!');
                return;
            }

            gameData.captainMoney[captain] += amount;
            saveData();
            renderAdminPanel();

            alert(`Added ${amount} YEN to ${captain}!`);
        }

        // ==========================================
        // PLAYER EDIT MODAL
        // ==========================================
        function openPlayerEditModal() {
            document.getElementById('playerEditModal').style.display = 'flex';
            renderPlayerEditContent();
        }

        function closePlayerEditModal() {
            document.getElementById('playerEditModal').style.display = 'none';
        }

        function renderPlayerEditContent() {
            const container = document.getElementById('playerEditContent');
            let html = '';

            // Wild Cards
            html += '<h4 style="color: #ffcc00; margin: 15px 0 10px;">WILD CARDS</h4>';
            gameData.wildcards.forEach((card, idx) => {
                html += `
                    <div class="edit-row">
                        <input type="text" value="${card.name}" onchange="gameData.wildcards[${idx}].name = this.value; saveData();">
                        <input type="number" value="${card.price}" onchange="gameData.wildcards[${idx}].price = parseInt(this.value); saveData();" placeholder="Price">
                        <input type="number" value="${card.count}" min="1" onchange="gameData.wildcards[${idx}].count = parseInt(this.value); gameData.wildcards[${idx}].available = Math.min(gameData.wildcards[${idx}].available, parseInt(this.value)); saveData();" placeholder="Count">
                        <button onclick="deletePlayer('wildcard', ${idx})">Delete</button>
                    </div>
                `;
            });

            // Tsugukos
            html += '<h4 style="color: #ffcc00; margin: 15px 0 10px;">TSUGUKOS</h4>';
            gameData.tsugukos.forEach((player, idx) => {
                html += `
                    <div class="edit-row">
                        <input type="text" value="${player.name}" onchange="gameData.tsugukos[${idx}].name = this.value; saveData();">
                        <input type="text" value="${player.tier || ''}" onchange="gameData.tsugukos[${idx}].tier = this.value; saveData();" placeholder="Tier">
                        <input type="number" value="${player.price}" onchange="gameData.tsugukos[${idx}].price = parseInt(this.value); saveData();" placeholder="Price">
                        <button onclick="deletePlayer('tsuguko', ${idx})">Delete</button>
                    </div>
                `;
            });

            // Hinoes
            html += '<h4 style="color: #ffcc00; margin: 15px 0 10px;">HINOES</h4>';
            gameData.hinoes.forEach((player, idx) => {
                html += `
                    <div class="edit-row">
                        <input type="text" value="${player.name}" onchange="gameData.hinoes[${idx}].name = this.value; saveData();">
                        <input type="text" value="-" disabled>
                        <input type="number" value="${player.price}" onchange="gameData.hinoes[${idx}].price = parseInt(this.value); saveData();" placeholder="Price">
                        <button onclick="deletePlayer('hinoe', ${idx})">Delete</button>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function deletePlayer(category, index) {
            if (!confirm('Delete this player?')) return;

            if (category === 'wildcard') {
                gameData.wildcards.splice(index, 1);
            } else if (category === 'tsuguko') {
                gameData.tsugukos.splice(index, 1);
            } else {
                gameData.hinoes.splice(index, 1);
            }

            saveData();
            renderPlayerEditContent();
            renderPlayersContainer();
        }

        function addNewPlayer(category) {
            const name = prompt('Enter player name:');
            if (!name) return;

            const price = parseInt(prompt('Enter price:', '150'));
            if (!price) return;

            if (category === 'wildcard') {
                const count = parseInt(prompt('How many available?', '3')) || 3;
                gameData.wildcards.push({ name, price, count, available: count });
            } else if (category === 'tsuguko') {
                const tier = prompt('Enter tier (e.g., S+, A, B-):', 'B');
                gameData.tsugukos.push({ name, tier, price });
            } else {
                gameData.hinoes.push({ name, price });
            }

            saveData();
            renderPlayerEditContent();
            renderPlayersContainer();
        }

        // ==========================================
        // MATCHES
        // ==========================================
        function setupMatches() {
            const teamsWithPlayers = gameData.captains.filter(c => (gameData.captainTeams[c] || []).length > 0);

            if (teamsWithPlayers.length < 2) {
                alert('Need at least 2 teams with players!');
                return;
            }

            // Simple modal for match setup
            let html = '<h3 style="color: #ffcc00; margin-bottom: 15px;">Setup Matches</h3>';
            html += '<div id="matchSetupList">';

            const numMatches = Math.floor(teamsWithPlayers.length / 2);
            for (let i = 0; i < Math.max(numMatches, 3); i++) {
                html += `
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <select id="match${i}team1" style="flex: 1; padding: 8px; background: #333; color: #fff; border: 1px solid #555;">
                            <option value="">Team 1</option>
                            ${teamsWithPlayers.map(t => `<option value="${t}">${t}</option>`).join('')}
                        </select>
                        <span style="padding: 8px;">VS</span>
                        <select id="match${i}team2" style="flex: 1; padding: 8px; background: #333; color: #fff; border: 1px solid #555;">
                            <option value="">Team 2</option>
                            ${teamsWithPlayers.map(t => `<option value="${t}">${t}</option>`).join('')}
                        </select>
                    </div>
                `;
            }

            html += '</div>';
            html += '<button class="modal-btn" onclick="confirmMatchSetup()">Start Matches</button>';
            html += '<button class="modal-btn cancel" onclick="closeMatchSetupModal()">Cancel</button>';

            // Show in a temporary modal
            const modal = document.createElement('div');
            modal.id = 'matchSetupModal';
            modal.className = 'modal-overlay';
            modal.innerHTML = `<div class="modal-box">${html}</div>`;
            document.body.appendChild(modal);
        }

        function closeMatchSetupModal() {
            const modal = document.getElementById('matchSetupModal');
            if (modal) modal.remove();
        }

        function confirmMatchSetup() {
            gameData.matches = [];

            for (let i = 0; i < 10; i++) {
                const team1El = document.getElementById(`match${i}team1`);
                const team2El = document.getElementById(`match${i}team2`);

                if (!team1El || !team2El) continue;

                const team1 = team1El.value;
                const team2 = team2El.value;

                if (team1 && team2 && team1 !== team2) {
                    gameData.matches.push({
                        id: Date.now() + i,
                        team1,
                        team2,
                        winner: null,
                        completed: false
                    });
                }
            }

            if (gameData.matches.length === 0) {
                alert('Setup at least one valid match!');
                return;
            }

            currentMatchIndex = 0;
            saveData();
            closeMatchSetupModal();
            renderMatchesContainer();

            alert(`${gameData.matches.length} matches created!`);
        }

        function renderMatchesContainer() {
            const container = document.getElementById('matchesContainer');

            if (gameData.matches.length === 0) {
                container.innerHTML = '<p style="color: #888;">No matches set up. Click "Setup Matches" to create matches.</p>';
                return;
            }

            container.innerHTML = gameData.matches.map((match, idx) => `
                <div class="match-card ${!match.completed && idx === currentMatchIndex ? 'active' : ''} ${match.completed ? 'completed' : ''}">
                    <div style="margin-bottom: 10px; color: ${match.completed ? '#888' : '#ffcc00'};">
                        Match ${idx + 1} ${match.completed ? '- COMPLETED' : idx === currentMatchIndex ? '- CURRENT' : ''}
                    </div>
                    <div class="match-teams">
                        <div class="match-team ${match.winner === match.team1 ? 'winner' : ''}">${match.team1}</div>
                        <div class="match-vs">VS</div>
                        <div class="match-team ${match.winner === match.team2 ? 'winner' : ''}">${match.team2}</div>
                    </div>
                    ${!match.completed ? `
                        <div class="match-controls">
                            <button class="btn-win" onclick="setMatchWinner(${idx}, '${match.team1}')">${match.team1} WINS</button>
                            <button class="btn-win" onclick="setMatchWinner(${idx}, '${match.team2}')">${match.team2} WINS</button>
                        </div>
                    ` : `
                        <div style="text-align: center; color: #00ff00; font-weight: bold;">Winner: ${match.winner}</div>
                    `}
                </div>
            `).join('');
        }

        function setMatchWinner(matchIndex, winner) {
            const match = gameData.matches[matchIndex];
            if (!match || match.completed) return;

            match.winner = winner;
            match.completed = true;

            // Add to history
            gameData.matchHistory.push({
                ...match,
                completedAt: new Date().toISOString()
            });

            // Resolve bets
            resolveBetsForMatch(match);

            // Move to next match
            if (currentMatchIndex === matchIndex) {
                currentMatchIndex++;
            }

            saveData();
            renderMatchesContainer();
            renderBettingPanel();
            renderSpectatorPanel();
        }

        // ==========================================
        // BETTING SYSTEM
        // ==========================================
        function renderBettingPanel() {
            renderCurrentMatchBet();
            renderBetOptions();
            renderActiveBets();
            renderBetHistory();
            renderTeamStandingsBetting();
        }

        function renderCurrentMatchBet() {
            const container = document.getElementById('currentMatchBet');
            const currentMatch = gameData.matches[currentMatchIndex];

            if (!currentMatch || currentMatch.completed) {
                container.innerHTML = '<p style="color: #888;">No active match</p>';
                return;
            }

            container.innerHTML = `
                <div class="current-match-bet">
                    <h4 style="color: #00ff00; margin-bottom: 10px;">CURRENT MATCH</h4>
                    <div style="font-size: 1.3em;">
                        <strong>${currentMatch.team1}</strong> VS <strong>${currentMatch.team2}</strong>
                    </div>
                </div>
            `;
        }

        function renderBetOptions() {
            const container = document.getElementById('betOptions');
            const currentMatch = gameData.matches[currentMatchIndex];

            if (!currentMatch || currentMatch.completed) {
                container.innerHTML = '<p style="color: #888;">No betting available</p>';
                return;
            }

            container.innerHTML = `
                <div class="bet-option">
                    <button onclick="placeBet('${currentMatch.team1}')" style="background: #00aa00; color: #fff;">
                        Bet on ${currentMatch.team1}
                    </button>
                    <button onclick="placeBet('${currentMatch.team2}')" style="background: #0099ff; color: #fff;">
                        Bet on ${currentMatch.team2}
                    </button>
                </div>
            `;
        }

        function placeBet(team) {
            const name = document.getElementById('bettorName').value.trim();
            const amount = parseInt(document.getElementById('betAmount').value);
            const currentMatch = gameData.matches[currentMatchIndex];

            if (!name) {
                alert('Enter your name!');
                return;
            }
            if (!amount || amount <= 0) {
                alert('Enter a valid bet amount!');
                return;
            }
            if (!currentMatch) {
                alert('No active match!');
                return;
            }

            const bet = {
                id: Date.now(),
                bettor: name,
                amount,
                team,
                opponent: team === currentMatch.team1 ? currentMatch.team2 : currentMatch.team1,
                matchId: currentMatch.id,
                matchIndex: currentMatchIndex,
                resolved: false,
                won: null
            };

            gameData.bets.push(bet);
            saveData();

            document.getElementById('betAmount').value = '';
            renderBettingPanel();

            alert(`Bet placed: ${amount} on ${team}!`);
        }

        function resolveBetsForMatch(match) {
            gameData.bets.forEach(bet => {
                if (bet.matchId === match.id && !bet.resolved) {
                    bet.resolved = true;
                    bet.won = bet.team === match.winner;

                    gameData.betHistory.push({
                        ...bet,
                        resolvedAt: new Date().toISOString()
                    });
                }
            });

            // Remove resolved bets from active
            gameData.bets = gameData.bets.filter(b => !b.resolved);
        }

        function renderActiveBets() {
            const container = document.getElementById('activeBetsList');

            if (gameData.bets.length === 0) {
                container.innerHTML = '<p style="color: #888;">No active bets</p>';
                return;
            }

            container.innerHTML = gameData.bets.map(bet => `
                <div class="bet-card">
                    <div><strong>${bet.bettor}</strong> bet ${bet.amount} YEN</div>
                    <div style="color: #ffcc00;">${bet.team} to win against ${bet.opponent}</div>
                </div>
            `).join('');
        }

        function renderBetHistory() {
            const container = document.getElementById('betHistory');

            if (gameData.betHistory.length === 0) {
                container.innerHTML = '<p style="color: #888;">No bet history</p>';
                return;
            }

            container.innerHTML = gameData.betHistory.slice(-10).reverse().map(bet => `
                <div class="bet-card ${bet.won ? 'won' : 'lost'}">
                    <div><strong>${bet.bettor}</strong> bet ${bet.amount} YEN on ${bet.team}</div>
                    <div style="color: ${bet.won ? '#00ff00' : '#aa0000'}; font-weight: bold;">
                        ${bet.won ? 'WON!' : 'LOST'}
                    </div>
                </div>
            `).join('');
        }

        function renderTeamStandingsBetting() {
            const container = document.getElementById('teamStandingsBetting');
            renderStandings(container);
        }

        // ==========================================
        // SPECTATOR PANEL
        // ==========================================
        function renderSpectatorPanel() {
            renderLiveMatches();
            renderSpectatorMatchHistory();
            renderTeamStandings();
            renderCardUsageSpectator();
        }

        function renderLiveMatches() {
            const container = document.getElementById('liveMatches');
            const currentMatch = gameData.matches[currentMatchIndex];

            if (!currentMatch || currentMatch.completed) {
                container.innerHTML = '<p style="color: #888;">No active match</p>';
                return;
            }

            container.innerHTML = `
                <div class="match-card active">
                    <h4 style="color: #00ff00;">NOW PLAYING</h4>
                    <div class="match-teams" style="margin-top: 10px;">
                        <div class="match-team">${currentMatch.team1}</div>
                        <div class="match-vs">VS</div>
                        <div class="match-team">${currentMatch.team2}</div>
                    </div>
                </div>
            `;
        }

        function renderSpectatorMatchHistory() {
            const container = document.getElementById('matchHistory');

            if (gameData.matchHistory.length === 0) {
                container.innerHTML = '<p style="color: #888;">No completed matches</p>';
                return;
            }

            container.innerHTML = gameData.matchHistory.slice(-10).reverse().map(match => `
                <div class="match-card completed">
                    <div class="match-teams">
                        <div class="match-team ${match.winner === match.team1 ? 'winner' : ''}">${match.team1}</div>
                        <div class="match-vs">VS</div>
                        <div class="match-team ${match.winner === match.team2 ? 'winner' : ''}">${match.team2}</div>
                    </div>
                    <div style="text-align: center; color: #00ff00; margin-top: 8px;">Winner: ${match.winner}</div>
                </div>
            `).join('');
        }

        function renderTeamStandings() {
            const container = document.getElementById('teamStandings');
            renderStandings(container);
        }

        function renderStandings(container) {
            const standings = gameData.captains.map(captain => {
                const wins = gameData.matchHistory.filter(m => m.winner === captain).length;
                const losses = gameData.matchHistory.filter(m =>
                    (m.team1 === captain || m.team2 === captain) && m.winner !== captain
                ).length;
                return { captain, wins, losses };
            }).sort((a, b) => b.wins - a.wins || a.losses - b.losses);

            container.innerHTML = standings.map((s, idx) => `
                <div class="stat-card" style="${idx === 0 && s.wins > 0 ? 'border-left-color: #ffcc00;' : ''}">
                    <h4>${idx === 0 && s.wins > 0 ? '1st - ' : ''}${s.captain}</h4>
                    <div>
                        <span style="color: #00ff00;">${s.wins}W</span> /
                        <span style="color: #aa0000;">${s.losses}L</span>
                    </div>
                </div>
            `).join('');
        }

        function renderCardUsageSpectator() {
            const container = document.getElementById('cardUsageSpectator');
            const entries = Object.entries(gameData.cardUsageCount);

            if (entries.length === 0) {
                container.innerHTML = '<p style="color: #888;">No cards used yet</p>';
                return;
            }

            container.innerHTML = '<div class="usage-stats">' +
                entries.sort((a, b) => b[1] - a[1]).map(([name, count]) => `
                    <div class="usage-stat">
                        <div>${name}</div>
                        <div class="count">${count}x</div>
                    </div>
                `).join('') + '</div>';
        }

        // ==========================================
        // RESET
        // ==========================================
        function resetAllData() {
            if (!confirm('WARNING: This will delete ALL data. Are you sure?')) return;
            if (!confirm('This cannot be undone. Really delete everything?')) return;

            localStorage.removeItem('sunriseCitySlamdown');
            location.reload();
        }

        // ==========================================
        // INITIALIZATION
        // ==========================================
        loadData();
        switchView('spectator');
    </script>
</body>
</html>
